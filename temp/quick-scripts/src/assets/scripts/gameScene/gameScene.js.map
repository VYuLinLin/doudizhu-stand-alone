{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\gameScene/assets\\scripts\\gameScene\\gameScene.js"],"names":["ddzConstants","require","ddzData","cc","Class","Component","properties","bjMusic","type","AudioClip","di_label","Label","beishu_label","roomid_label","player_node_prefabs","Prefab","btn_ready","Node","players_seat_pos","onLoad","console","log","gameState","CC_EDITOR","gameStateNotify","addListener","gameStateHandler","playerNodeList","roomId","myglobal","playerData","split","rate","bottom","string","defines","roomNames","active","GAMESTART","isopen_sound","audioEngine","stopAll","addPlayerNode","rootList","node","on","i","length","emit","bind","socket","onRoomChangeState","data","roomstate","event","gameui_node","getChildByName","request_enter_room","err","result","JSON","stringify","seatid","seatindex","playerdata_list_pos","setPlayerSeatPos","playerdata_list","playerdata","housemanageid","gamebefore_node","onPlayerJoinRoom","join_playerdata","onPlayerReady","onGameStart","gamebeforeUI","onChangeMaster","master_accountid","onShowBottomCard","start","$socket","canrobStateNotify","onDestroy","removeListener","remove","value","onGoback","INVALID","sys","localStorage","setItem","director","loadScene","onBtnReadey","forEach","player_data","playernode_inst","instantiate","parent","push","index","position","children","getComponent","init_data","getUserOutCardPosByAccount","accountid","node_script","seat_node","seat_index","index_name","out_card_node"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\gameScene","sourcesContent":["import myglobal from \"../mygolbal.js\"\r\nconst ddzConstants = require('ddzConstants')\r\nconst ddzData = require('ddzData')\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n  properties: {\r\n    bjMusic: {\r\n      type: cc.AudioClip, // 背景音乐\r\n      default: null,     // object's default value is null\r\n    }, \r\n    di_label: cc.Label,\r\n    beishu_label: cc.Label,\r\n    roomid_label: cc.Label,\r\n    player_node_prefabs: cc.Prefab,\r\n    btn_ready: cc.Node, // 准备按钮\r\n    //绑定玩家座位,下面有3个子节点\r\n    players_seat_pos: cc.Node\r\n  },\r\n  onLoad() {\r\n    console.log(ddzData.gameState)\r\n    if(!CC_EDITOR) {\r\n      ddzData.gameStateNotify.addListener(this.gameStateHandler, this)\r\n    }\r\n    this.playerNodeList = []\r\n    const { roomId }= myglobal.playerData\r\n    const [rate, bottom] = roomId.split('_')\r\n    myglobal.playerData.rate = rate\r\n    myglobal.playerData.bottom = bottom\r\n    \r\n    this.roomid_label.string = defines.roomNames[rate - 1]\r\n    this.beishu_label.string = \"倍数：\" + rate\r\n    this.di_label.string = \"底：\" + bottom\r\n    \r\n    // this.roomstate = ddzConstants.gameState.ROOM_INVALID\r\n    this.btn_ready.active = ddzData.gameState < ddzConstants.gameState.GAMESTART // 准备按钮\r\n    if (isopen_sound) {\r\n      cc.audioEngine.stopAll()\r\n      // cc.audioEngine.play(this.bjMusic, true)\r\n    }\r\n    this.addPlayerNode(myglobal.playerData)\r\n    this.addPlayerNode(myglobal.playerData.rootList[0])\r\n    this.addPlayerNode(myglobal.playerData.rootList[1])\r\n    //监听，给其他玩家发牌(内部事件)\r\n    this.node.on(\"pushcard_other_event\", function () {\r\n      console.log('其他玩家发牌')\r\n      for (let i = 0; i < this.playerNodeList.length; i++) {\r\n        const node = this.playerNodeList[i]\r\n        if (node) {\r\n          //给playernode节点发送事件\r\n          node.emit(\"push_card_event\")\r\n        }\r\n      }\r\n    }.bind(this))\r\n    \r\n    //监听房间状态改变事件\r\n    myglobal.socket.onRoomChangeState(function (data) {\r\n      //回调的函数参数是进入房间用户消息\r\n      console.log(\"onRoomChangeState:\" + data)\r\n      this.roomstate = data\r\n    }.bind(this))\r\n    // 抢地主\r\n    this.node.on(\"canrob_event\", function (event) {\r\n      console.log(\"gamescene canrob_event:\" + event)\r\n      //通知给playernode子节点\r\n      for (var i = 0; i < this.playerNodeList.length; i++) {\r\n        var node = this.playerNodeList[i]\r\n        if (node) {\r\n          //给playernode节点发送事件\r\n          node.emit(\"playernode_canrob_event\", event)\r\n        }\r\n      }\r\n    }.bind(this))\r\n\r\n    this.node.on(\"choose_card_event\", function (event) {\r\n      console.log(\"--------choose_card_event-----------\")\r\n      var gameui_node = this.node.getChildByName(\"gameingUI\")\r\n      if (gameui_node == null) {\r\n        console.log(\"get childer name gameingUI\")\r\n        return\r\n      }\r\n      gameui_node.emit(\"choose_card_event\", event)\r\n\r\n    }.bind(this))\r\n\r\n    this.node.on(\"unchoose_card_event\", function (event) {\r\n      console.log(\"--------unchoose_card_event-----------\")\r\n      var gameui_node = this.node.getChildByName(\"gameingUI\")\r\n      if (gameui_node == null) {\r\n        console.log(\"get childer name gameingUI\")\r\n        return\r\n      }\r\n      gameui_node.emit(\"unchoose_card_event\", event)\r\n    }.bind(this))\r\n    //监听给玩家添加三张底牌\r\n    // this.node.on(\"add_three_card\",function(event){\r\n    //     console.log(\"add_three_card:\"+event)\r\n    //     for(var i=0;i<this.playerNodeList.length;i++){\r\n    //         var node = this.playerNodeList[i]\r\n    //         if(node){\r\n    //             //给playernode节点发送事件\r\n    //             node.emit(\"playernode_add_three_card\",event)\r\n    //         }\r\n    //     }\r\n    // }.bind(this))\r\n    return\r\n\r\n    myglobal.socket.request_enter_room({}, function (err, result) {\r\n      console.log(\"enter_room_resp\" + JSON.stringify(result))\r\n      if (err != 0) {\r\n        console.log(\"enter_room_resp err:\" + err)\r\n      } else {\r\n\r\n        //enter_room成功\r\n        //notify ={\"seatid\":1,\"playerdata\":[{\"accountid\":\"2117836\",\"userName\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}]}\r\n        var seatid = result.seatindex //自己在房间里的seatid\r\n        this.playerdata_list_pos = []  //3个用户创建一个空用户列表\r\n        this.setPlayerSeatPos(seatid)\r\n\r\n        var playerdata_list = result.playerdata\r\n        var roomId = result.roomId\r\n        this.roomid_label.string = \"房间号:\" + roomId\r\n        myglobal.playerData.housemanageid = result.housemanageid\r\n\r\n        for (var i = 0; i < playerdata_list.length; i++) {\r\n          //consol.log(\"this----\"+this)\r\n          this.addPlayerNode(playerdata_list[i])\r\n        }\r\n\r\n        \r\n      }\r\n      var gamebefore_node = this.node.getChildByName(\"gamebeforeUI\")\r\n      gamebefore_node.emit(\"init\")\r\n    }.bind(this))\r\n\r\n    //在进入房间后，注册其他玩家进入房间的事件\r\n    myglobal.socket.onPlayerJoinRoom(function (join_playerdata) {\r\n      //回调的函数参数是进入房间用户消息\r\n      console.log(\"onPlayerJoinRoom:\" + JSON.stringify(join_playerdata))\r\n      this.addPlayerNode(join_playerdata)\r\n    }.bind(this))\r\n\r\n    //回调参数是发送准备消息的accountid\r\n    myglobal.socket.onPlayerReady(function (data) {\r\n      console.log(\"-------onPlayerReady:\" + data)\r\n      for (var i = 0; i < this.playerNodeList.length; i++) {\r\n        var node = this.playerNodeList[i]\r\n        if (node) {\r\n          node.emit(\"player_ready_notify\", data)\r\n        }\r\n      }\r\n    }.bind(this))\r\n\r\n    myglobal.socket.onGameStart(function () {\r\n      for (var i = 0; i < this.playerNodeList.length; i++) {\r\n        var node = this.playerNodeList[i]\r\n        if (node) {\r\n          node.emit(\"gamestart_event\")\r\n        }\r\n      }\r\n\r\n      //隐藏gamebeforeUI节点\r\n      var gamebeforeUI = this.node.getChildByName(\"gamebeforeUI\")\r\n      if (gamebeforeUI) {\r\n        gamebeforeUI.active = false\r\n      }\r\n    }.bind(this))\r\n\r\n    //监听服务器玩家抢地主消息\r\n    // myglobal.socket.onRobState(function (event) {\r\n    //   console.log(\"-----onRobState\" + JSON.stringify(event))\r\n    //   //onRobState{\"accountid\":\"2162866\",\"state\":1}\r\n    //   for (var i = 0; i < this.playerNodeList.length; i++) {\r\n    //     var node = this.playerNodeList[i]\r\n    //     if (node) {\r\n    //       //给playernode节点发送事件\r\n    //       node.emit(\"playernode_rob_state_event\", event)\r\n    //     }\r\n    //   }\r\n    // }.bind(this))\r\n\r\n    //注册监听服务器确定地主消息\r\n    myglobal.socket.onChangeMaster(function (event) {\r\n      console.log(\"onChangeMaster\" + event)\r\n      //保存一下地主id\r\n      myglobal.playerData.master_accountid = event\r\n      for (var i = 0; i < this.playerNodeList.length; i++) {\r\n        var node = this.playerNodeList[i]\r\n        if (node) {\r\n          //给playernode节点发送事件\r\n          node.emit(\"playernode_changemaster_event\", event)\r\n        }\r\n      }\r\n    }.bind(this))\r\n\r\n    //注册监听服务器显示底牌消息\r\n    myglobal.socket.onShowBottomCard(function (event) {\r\n      console.log(\"onShowBottomCard---------\" + event)\r\n      var gameui_node = this.node.getChildByName(\"gameingUI\")\r\n      if (gameui_node == null) {\r\n        console.log(\"get childer name gameingUI\")\r\n        return\r\n      }\r\n      gameui_node.emit(\"show_bottom_card_event\", event)\r\n    }.bind(this))\r\n  },\r\n  start() {\r\n    $socket.on('canrob_state_notify', this.canrobStateNotify, this)\r\n  },\r\n  onDestroy() {\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.removeListener(this.gameStateHandler, this)\r\n    }\r\n    $socket.remove('canrob_state_notify', this)\r\n  },\r\n  canrobStateNotify(data) {\r\n    for (var i = 0; i < this.playerNodeList.length; i++) {\r\n      var node = this.playerNodeList[i]\r\n      if (node) {\r\n        //给playernode节点发送事件\r\n        node.emit(\"playernode_rob_state_event\", data)\r\n      }\r\n    }\r\n  },\r\n  gameStateHandler(value) {\r\n    console.log(value)\r\n  },\r\n  // 返回大厅\r\n  onGoback() {\r\n    ddzData.gameState = ddzConstants.gameState.INVALID\r\n    myglobal.playerData.roomId = ''\r\n    cc.sys.localStorage.setItem('userData', JSON.stringify(myglobal.playerData))\r\n    cc.director.loadScene(\"hallScene\")\r\n  },\r\n  // 准备\r\n  onBtnReadey(event) {\r\n    this.btn_ready.active = false\r\n    // this.playerNodeList[0].emit(\"player_ready_notify\")\r\n    this.playerNodeList.forEach(node => {\r\n      node.emit(\"gamestart_event\")\r\n    });\r\n    ddzData.gameState = ddzConstants.gameState.GAMESTART\r\n  },\r\n  //seat_index自己在房间的位置id\r\n  // setPlayerSeatPos(seat_index) {\r\n  //   if (seat_index < 1 || seat_index > 3) {\r\n  //     console.log(\"seat_index error\" + seat_index)\r\n  //     return\r\n  //   }\r\n\r\n  //   console.log(\"setPlayerSeatPos seat_index:\" + seat_index)\r\n\r\n  //   //界面位置转化成逻辑位置\r\n  //   switch (seat_index) {\r\n  //     case 1:\r\n  //       this.playerdata_list_pos[1] = 0\r\n  //       this.playerdata_list_pos[2] = 1\r\n  //       this.playerdata_list_pos[3] = 2\r\n  //       break\r\n  //     case 2:\r\n\r\n\r\n  //       this.playerdata_list_pos[2] = 0\r\n  //       this.playerdata_list_pos[3] = 1\r\n  //       this.playerdata_list_pos[1] = 2\r\n  //       break\r\n  //     case 3:\r\n  //       this.playerdata_list_pos[3] = 0\r\n  //       this.playerdata_list_pos[1] = 1\r\n  //       this.playerdata_list_pos[2] = 2\r\n  //       break\r\n  //     default:\r\n  //       break\r\n  //   }\r\n  // },\r\n  // 添加玩家节点\r\n  addPlayerNode(player_data) {\r\n    var playernode_inst = cc.instantiate(this.player_node_prefabs)\r\n    playernode_inst.parent = this.node\r\n    //创建的节点存储在gamescene的列表中\r\n    this.playerNodeList.push(playernode_inst)\r\n    \r\n    //玩家在room里的位置索引(逻辑位置)\r\n    var index = player_data.seatindex\r\n    playernode_inst.position = this.players_seat_pos.children[index].position\r\n    playernode_inst.getComponent(\"player_node\").init_data(player_data, index)\r\n\r\n    // myglobal.playerData.playerList[index] = player_data\r\n  },\r\n\r\n  /*\r\n   //通过accountid获取用户出牌放在gamescend的位置 \r\n   做法：先放3个节点在gameacene的场景中cardsoutzone(012)\r\n         \r\n  */\r\n  getUserOutCardPosByAccount(accountid) {\r\n    console.log(\"getUserOutCardPosByAccount accountid:\" + accountid)\r\n    for (var i = 0; i < this.playerNodeList.length; i++) {\r\n      var node = this.playerNodeList[i]\r\n      if (node) {\r\n        //获取节点绑定的组件\r\n        var node_script = node.getComponent(\"player_node\")\r\n        //如果accountid和player_node节点绑定的accountid相同\r\n        //接获取player_node的子节点\r\n        if (node_script.accountid === accountid) {\r\n          var seat_node = this.players_seat_pos.children[node_script.seat_index]\r\n          var index_name = \"cardsoutzone\" + node_script.seat_index\r\n          //console.log(\"getUserOutCardPosByAccount index_name:\"+index_name)\r\n          var out_card_node = seat_node.getChildByName(index_name)\r\n          //console.log(\"OutZone:\"+ out_card_node.name)\r\n          return out_card_node\r\n        }\r\n      }\r\n    }\r\n\r\n    return null\r\n  },\r\n  // update (dt) {},\r\n});\r\n"]}