{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs/assets\\scripts\\gameScene\\prefabs\\player_node.js"],"names":["ddzConstants","require","ddzData","cc","Class","Component","properties","headImage","Sprite","nickname_label","Label","globalcount_label","readyimage","Node","offlineimage","card_node","card_prefab","Prefab","clockimage","qiangdidzhu_node","time_label","robimage_sp","SpriteFrame","robnoimage_sp","robIconSp","robIcon_Sp","robnoIcon_Sp","masterIcon","onLoad","active","gameState","GAMESTART","node","on","event","seat_index","pushCard","bind","detail","userId","state","qian_state","qian","console","log","buqiang","start","init_data","data","index","string","userName","goldcount","cardlist_node","head_image_path","avatarUrl","loader","loadRes","err","spriteFrame","message","landlordId","schedulerOnce","x","count","callback","unschedule","window","$socket","emit","schedule","i","card","instantiate","scale","parent","name","height","y","push"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs","sourcesContent":["import myglobal from \"../../mygolbal.js\"\r\nconst ddzConstants = require('ddzConstants')\r\nconst ddzData = require('ddzData')\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    headImage: cc.Sprite,\r\n    // account_label: cc.Label,\r\n    nickname_label: cc.Label,\r\n    // room_touxiang: cc.Sprite,\r\n    globalcount_label: cc.Label,\r\n    // headimage: cc.Sprite,\r\n    readyimage: cc.Node,\r\n    offlineimage: cc.Node,\r\n    card_node: cc.Node,\r\n    card_prefab: cc.Prefab,\r\n    //tips_label:cc.Label,\r\n    clockimage: cc.Node,\r\n    qiangdidzhu_node: cc.Node, //抢地主的父节点\r\n    time_label: cc.Label,\r\n    robimage_sp: cc.SpriteFrame,\r\n    robnoimage_sp: cc.SpriteFrame,\r\n    robIconSp: cc.Sprite,\r\n    robIcon_Sp: cc.Node,\r\n    robnoIcon_Sp: cc.Node,\r\n    masterIcon: cc.Node,\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad() {\r\n    this.readyimage.active = ddzData.gameState < ddzConstants.gameState.GAMESTART\r\n    this.offlineimage.active = false\r\n    //  准备开始\r\n    this.node.on(\"player_ready_notify\", () => {\r\n      this.readyimage.active = true\r\n    })\r\n    // 开始游戏(客户端发给客户端)\r\n    this.node.on(\"gamestart_event\", () => {\r\n      this.readyimage.active = false\r\n    })\r\n\r\n    //给其他玩家发牌事件\r\n    this.node.on(\"push_card_event\", function (event) {\r\n      if (this.seat_index === 0) return // 自己不再发牌\r\n      this.pushCard()\r\n    }.bind(this))\r\n\r\n    this.node.on(\"playernode_rob_state_event\", function (event) {\r\n      // this.node.on(\"playernode_rob_state_event\", function (event) {\r\n      //{\"userId\":\"2162866\",\"state\":1}\r\n      var detail = event\r\n\r\n      //如果是自己在抢，需要隐藏qiangdidzhu_node节点\r\n      //this.userId表示这个节点挂接的userId\r\n      if (detail.userId == this.userId) {\r\n        this.qiangdidzhu_node.active = false\r\n      }\r\n      if (this.userId == detail.userId) {\r\n        if (detail.state == qian_state.qian) {\r\n          console.log(\"this.robIcon_Sp.active = true\")\r\n          this.robIcon_Sp.active = true\r\n\r\n        } else if (detail.state == qian_state.buqiang) {\r\n          this.robnoIcon_Sp.active = true\r\n\r\n        } else {\r\n          console.log(\"get rob value :\" + detail.state)\r\n        }\r\n      }\r\n\r\n    }.bind(this))\r\n\r\n    this.node.on(\"playernode_changemaster_event\", function (event) {\r\n      var detail = event\r\n      this.robIcon_Sp.active = false\r\n      this.robnoIcon_Sp.active = false\r\n      if (detail === this.userId) {\r\n        this.masterIcon.active = true\r\n      }\r\n    }.bind(this))\r\n\r\n    // this.node.on(\"playernode_add_three_card\",function(event){\r\n    //   var detail = event //地主的accountid\r\n    //   if(detail==this.userId){\r\n    //     //给地主发三张排\r\n\r\n    //   }\r\n    // }.bind(this))\r\n  },\r\n\r\n  start() {\r\n\r\n  },\r\n\r\n  //这里初始化房间内位置节点信息(自己和其他玩家)\r\n  //data玩家节点数据\r\n  //index玩家在房间的位置索引\r\n  init_data(data, index) {\r\n    // console.log(\"init_data:\" + JSON.stringify(data))\r\n    //data:{\"userId\":\"2117836\",\"userName\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}\r\n    this.userId = data.userId\r\n    // this.account_label.string = data.accountid\r\n    this.nickname_label.string = data.userName\r\n    this.globalcount_label.string = data.goldcount\r\n    this.cardlist_node = []\r\n    this.seat_index = index\r\n    //这里根据传入的avarter来获取本地图像\r\n    var head_image_path = \"UI/headimage/\" + data.avatarUrl\r\n    cc.loader.loadRes(head_image_path, cc.SpriteFrame, function (err, spriteFrame) {\r\n      if (err) {\r\n        console.log(err.message || err);\r\n        return;\r\n      }\r\n      this.headImage.spriteFrame = spriteFrame;\r\n    }.bind(this));\r\n    if (!index) {\r\n      this.readyimage.active = false\r\n      return\r\n    }\r\n    // 机器人监听内部谁可以抢地主消息\r\n    this.node.on(\"playernode_canrob_event\", function (landlordId) {\r\n      console.log(\"------playernode_canrob_event detail:\" + landlordId)\r\n      if (landlordId === this.userId) {\r\n        this.qiangdidzhu_node.active = true\r\n        this.schedulerOnce()\r\n      }\r\n    }.bind(this))\r\n    // 更改右边机器人的扑克牌位置\r\n    if (index === 1) {\r\n      this.card_node.x = -this.card_node.x\r\n    }\r\n  },\r\n  //开启一个定时器\r\n  schedulerOnce() {\r\n    this.count = 10;\r\n    this.time_label.string = this.count\r\n    const callback = function () {\r\n      if (!this.count) {\r\n        // 在第六次执行回调时取消这个计时器\r\n        this.qiangdidzhu_node.active = false\r\n        this.unschedule(callback)\r\n        window.$socket.emit('canrob_state_notify', {\r\n          userId: this.userId,\r\n          state: qian_state.buqiang,\r\n        })\r\n      }\r\n      this.time_label.string = --this.count\r\n    }\r\n    this.schedule(callback, 1, 10)\r\n  },\r\n  pushCard() {\r\n    this.card_node.active = true\r\n    for (var i = 0; i < 17; i++) {\r\n      var card = cc.instantiate(this.card_prefab)\r\n      card.scale = 0.6\r\n      console.log(\" this.card_node.parent.parent\" + this.card_node.parent.parent.name)\r\n      card.parent = this.card_node\r\n      var height = card.height\r\n      card.y = (17 - 1) * 0.5 * height * 0.4 * 0.3 - height * 0.4 * 0.3 * i;\r\n      card.x = 0\r\n      this.cardlist_node.push(card)\r\n    }\r\n  },\r\n});\r\n"]}