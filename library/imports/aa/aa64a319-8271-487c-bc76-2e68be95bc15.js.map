{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs/assets\\scripts\\gameScene\\prefabs\\player_node.js"],"names":["ddzConstants","require","ddzData","cc","Class","Component","properties","headImage","Sprite","nickname_label","Label","globalcount_label","readyimage","Node","card_node","card_prefab","Prefab","clockimage","qiangdidzhu_node","time_label","robimage_sp","SpriteFrame","robnoimage_sp","robIconSp","robIcon_Sp","robnoIcon_Sp","masterIcon","jiaodizhu","type","AudioClip","buqiang","getGameScene","find","getComponent","onLoad","active","gameState","GAMESTART","node","on","event","seat_index","pushCard","bind","userId","myglobal","playerData","card","cardlist_node","getChildByName","string","start","CC_EDITOR","gameStateNotify","addListener","gameStateHandler","window","$socket","canrobNotify","gameEndNotify","onDestroy","removeListener","remove","init_data","data","index","userName","goldcount","head_image_path","avatarUrl","loader","loadRes","err","spriteFrame","console","log","message","x","state","removeAllChildren","clearOutZone","landlordId","isQdz","common","random","schedulerOnce","emit","qian_state","qiang","audio","PlayEffect","fn","seconds","count","callback","unschedule","schedule","instantiate","scale","parent","push","subtractCards","len","length","countLabel","Number","otherPlayerCards","cardList","cards","sort","a","b","val","i","showCards","gameScene_script","outCard_node","getUserOutCardPosByAccount","children","destroy"],"mappings":";;;;;;AAAA;;;;AACA,IAAMA,YAAY,GAAGC,OAAO,CAAC,cAAD,CAA5B;;AACA,IAAMC,OAAO,GAAGD,OAAO,CAAC,SAAD,CAAvB;;AACAE,EAAE,CAACC,KAAH,CAAS;AACP,aAASD,EAAE,CAACE,SADL;AAGPC,EAAAA,UAAU,EAAE;AACVC,IAAAA,SAAS,EAAEJ,EAAE,CAACK,MADJ;AAEV;AACAC,IAAAA,cAAc,EAAEN,EAAE,CAACO,KAHT;AAIV;AACAC,IAAAA,iBAAiB,EAAER,EAAE,CAACO,KALZ;AAMV;AACAE,IAAAA,UAAU,EAAET,EAAE,CAACU,IAPL;AAQVC,IAAAA,SAAS,EAAEX,EAAE,CAACU,IARJ;AAQU;AACpBE,IAAAA,WAAW,EAAEZ,EAAE,CAACa,MATN;AAUV;AACAC,IAAAA,UAAU,EAAEd,EAAE,CAACU,IAXL;AAYVK,IAAAA,gBAAgB,EAAEf,EAAE,CAACU,IAZX;AAYiB;AAC3BM,IAAAA,UAAU,EAAEhB,EAAE,CAACO,KAbL;AAcVU,IAAAA,WAAW,EAAEjB,EAAE,CAACkB,WAdN;AAeVC,IAAAA,aAAa,EAAEnB,EAAE,CAACkB,WAfR;AAgBVE,IAAAA,SAAS,EAAEpB,EAAE,CAACK,MAhBJ;AAiBVgB,IAAAA,UAAU,EAAErB,EAAE,CAACU,IAjBL;AAkBVY,IAAAA,YAAY,EAAEtB,EAAE,CAACU,IAlBP;AAmBVa,IAAAA,UAAU,EAAEvB,EAAE,CAACU,IAnBL;AAmBW;AACrBc,IAAAA,SAAS,EAAE;AACTC,MAAAA,IAAI,EAAEzB,EAAE,CAAC0B,SADA;AAET,iBAAS;AAFA,KApBD;AAwBVC,IAAAA,OAAO,EAAE;AACPF,MAAAA,IAAI,EAAEzB,EAAE,CAAC0B,SADF;AAEP,iBAAS;AAFF;AAxBC,GAHL;AAiCP;AACAE,EAAAA,YAlCO,0BAkCQ;AACb,WAAO5B,EAAE,CAAC6B,IAAH,CAAQ,QAAR,EAAkBC,YAAlB,CAA+B,WAA/B,CAAP;AACD,GApCM;AAqCPC,EAAAA,MArCO,oBAqCE;AAAA;;AACP,SAAKtB,UAAL,CAAgBuB,MAAhB,GAAyBjC,OAAO,CAACkC,SAAR,GAAoBpC,YAAY,CAACoC,SAAb,CAAuBC,SAApE;AACA,SAAKX,UAAL,CAAgBS,MAAhB,GAAyB,KAAzB,CAFO,CAGP;;AACA,SAAKG,IAAL,CAAUC,EAAV,CAAa,qBAAb,EAAoC,YAAM;AACxC,MAAA,KAAI,CAAC3B,UAAL,CAAgBuB,MAAhB,GAAyB,IAAzB;AACD,KAFD,EAJO,CAOP;;AACA,SAAKG,IAAL,CAAUC,EAAV,CAAa,iBAAb,EAAgC,YAAM;AACpC,MAAA,KAAI,CAAC3B,UAAL,CAAgBuB,MAAhB,GAAyB,KAAzB;AACD,KAFD,EARO,CAYP;;AACA,SAAKG,IAAL,CAAUC,EAAV,CAAa,iBAAb,EAAgC,UAAUC,KAAV,EAAiB;AAC/C,UAAI,KAAKC,UAAL,KAAoB,CAAxB,EAA2B,OADoB,CACb;;AAClC,WAAKC,QAAL;AACD,KAH+B,CAG9BC,IAH8B,CAGzB,IAHyB,CAAhC,EAbO,CAiBP;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AAEA,SAAKL,IAAL,CAAUC,EAAV,CAAa,+BAAb,EAA8C,UAAUK,MAAV,EAAkB;AAC9D,WAAKpB,UAAL,CAAgBW,MAAhB,GAAyB,KAAzB;AACA,WAAKV,YAAL,CAAkBU,MAAlB,GAA2B,KAA3B;AACA,UAAIS,MAAM,KAAK,KAAKA,MAApB,EAA4B;AAC5B,WAAKlB,UAAL,CAAgBS,MAAhB,GAAyB,IAAzB;AACA,UAAIS,MAAM,KAAKC,qBAASC,UAAT,CAAoBF,MAAnC,EAA2C;AAC3C,UAAMG,IAAI,GAAG,KAAKC,aAAL,CAAmB,CAAnB,CAAb;AACAD,MAAAA,IAAI,KAAKA,IAAI,CAACE,cAAL,CAAoB,OAApB,EAA6BhB,YAA7B,CAA0C9B,EAAE,CAACO,KAA7C,EAAoDwC,MAApD,GAA6D,EAAlE,CAAJ;AACD,KAR6C,CAQ5CP,IAR4C,CAQvC,IARuC,CAA9C,EA1CO,CAoDP;AACA;AACA;AACA;AAEA;AACA;AACD,GAhGM;AAkGPQ,EAAAA,KAlGO,mBAkGC;AACN;AACA,QAAI,CAACC,SAAL,EAAgB;AACdlD,MAAAA,OAAO,CAACmD,eAAR,CAAwBC,WAAxB,CAAoC,KAAKC,gBAAzC,EAA2D,IAA3D;AACD;;AACDC,IAAAA,MAAM,CAACC,OAAP,CAAelB,EAAf,CAAkB,eAAlB,EAAmC,KAAKmB,YAAxC,EAAsD,IAAtD,EALM,CAKsD;;AAC5DF,IAAAA,MAAM,CAACC,OAAP,CAAelB,EAAf,CAAkB,eAAlB,EAAmC,KAAKoB,aAAxC,EAAuD,IAAvD,EANM,CAMuD;AAC9D,GAzGM;AA0GPC,EAAAA,SA1GO,uBA0GK;AACV,QAAI,CAACR,SAAL,EAAgB;AACdlD,MAAAA,OAAO,CAACmD,eAAR,CAAwBQ,cAAxB,CAAuC,KAAKN,gBAA5C,EAA8D,IAA9D;AACD;;AACDC,IAAAA,MAAM,CAACC,OAAP,CAAeK,MAAf,CAAsB,eAAtB,EAAuC,IAAvC;AACAN,IAAAA,MAAM,CAACC,OAAP,CAAeK,MAAf,CAAsB,eAAtB,EAAuC,IAAvC;AACD,GAhHM;AAiHP;AACA;AACA;AACAC,EAAAA,SApHO,qBAoHGC,IApHH,EAoHSC,KApHT,EAoHgB;AACrB;AACA,SAAKrB,MAAL,GAAcoB,IAAI,CAACpB,MAAnB,CAFqB,CAGrB;;AACA,SAAKnC,cAAL,CAAoByC,MAApB,GAA6Bc,IAAI,CAACE,QAAlC;AACA,SAAKvD,iBAAL,CAAuBuC,MAAvB,GAAgCc,IAAI,CAACG,SAArC;AACA,SAAKnB,aAAL,GAAqB,EAArB;AACA,SAAKP,UAAL,GAAkBwB,KAAlB,CAPqB,CAQrB;;AACA,QAAIG,eAAe,GAAG,kBAAkBJ,IAAI,CAACK,SAA7C;AACAlE,IAAAA,EAAE,CAACmE,MAAH,CAAUC,OAAV,CAAkBH,eAAlB,EAAmCjE,EAAE,CAACkB,WAAtC,EAAmD,UAAUmD,GAAV,EAAeC,WAAf,EAA4B;AAC7E,UAAID,GAAJ,EAAS;AACPE,QAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAJ,IAAeJ,GAA3B;AACA;AACD;;AACD,WAAKjE,SAAL,CAAekE,WAAf,GAA6BA,WAA7B;AACD,KANkD,CAMjD9B,IANiD,CAM5C,IAN4C,CAAnD;;AAOA,QAAI,CAACsB,KAAL,EAAY;AACV,WAAKrD,UAAL,CAAgBuB,MAAhB,GAAyB,KAAzB;AACA;AACD,KApBoB,CAqBrB;;;AACA,QAAI8B,KAAK,KAAK,CAAd,EAAiB;AACf,WAAKnD,SAAL,CAAe+D,CAAf,GAAmB,CAAC,KAAK/D,SAAL,CAAe+D,CAAnC;AACD;AACF,GA7IM;AA8IPtB,EAAAA,gBA9IO,4BA8IUuB,KA9IV,EA8IiB;AACtB;AACA,QAAIA,KAAK,KAAK9E,YAAY,CAACoC,SAAb,CAAuBC,SAArC,EAAgD;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA,WAAKW,aAAL,GAAqB,EAArB;AACA,WAAKlC,SAAL,CAAeiE,iBAAf;AACA,WAAKC,YAAL;AACA,WAAKtD,UAAL,CAAgBS,MAAhB,GAAyB,KAAzB,CAV8C,CAUf;AAChC;AACF,GA5JM;AA6JP;AACAuB,EAAAA,YA9JO,wBA8JMuB,UA9JN,EA8JkB;AAAA;;AACvB,QAAIA,UAAU,KAAK,KAAKrC,MAApB,IAA8BqC,UAAU,KAAKpC,qBAASC,UAAT,CAAoBF,MAArE,EAA6E;AAC3E,WAAKpB,UAAL,CAAgBW,MAAhB,GAAyB,KAAzB;AACA,WAAKV,YAAL,CAAkBU,MAAlB,GAA2B,KAA3B;AACA,UAAM+C,KAAK,GAAGC,MAAM,CAACC,MAAP,CAAc,CAAd,EAAiB,EAAjB,IAAuB,CAArC,CAH2E,CAGpC;;AACvC,WAAKC,aAAL,CAAmB,YAAM;AACvBH,QAAAA,KAAK,KAAK,MAAI,CAAC1D,UAAL,CAAgBW,MAAhB,GAAyB,IAA9B,CAAL,CADuB,CACkB;;AACzC,SAAC+C,KAAD,KAAW,MAAI,CAACzD,YAAL,CAAkBU,MAAlB,GAA2B,IAAtC,EAFuB,CAEqB;;AAC5CqB,QAAAA,MAAM,CAACC,OAAP,CAAe6B,IAAf,CAAoB,qBAApB,EAA2C;AACzC1C,UAAAA,MAAM,EAAE,MAAI,CAACA,MAD4B;AAEzCkC,UAAAA,KAAK,EAAEI,KAAK,GAAGK,UAAU,CAACC,KAAd,GAAsBD,UAAU,CAACzD;AAFJ,SAA3C;AAIAqD,QAAAA,MAAM,CAACM,KAAP,CAAaC,UAAb,CAAwBR,KAAK,GAAG,MAAI,CAACvD,SAAR,GAAoB,MAAI,CAACG,OAAtD;AACD,OARD;AASD;AACF,GA7KM;;AA8KP;;;;;AAKAuD,EAAAA,aAnLO,yBAmLOM,EAnLP,EAmL2C;AAAA,QAAhCC,OAAgC,uEAAtBT,MAAM,CAACC,MAAP,CAAc,CAAd,EAAiB,EAAjB,CAAsB;AAChD,SAAKS,KAAL,GAAa,EAAb;AACA,SAAK1E,UAAL,CAAgB+B,MAAhB,GAAyB,KAAK2C,KAA9B;AACA,SAAK3E,gBAAL,CAAsBiB,MAAtB,GAA+B,IAA/B;;AACA,QAAM2D,QAAQ,GAAG,SAAXA,QAAW,GAAY;AAC3B,UAAI,CAAC,KAAKD,KAAN,IAAgB,KAAKD,OAAN,KAAmB,KAAKC,KAA3C,EAAkD;AAChD;AACA,aAAK3E,gBAAL,CAAsBiB,MAAtB,GAA+B,KAA/B;AACA,aAAK4D,UAAL,CAAgBD,QAAhB;AACAH,QAAAA,EAAE,IAAIA,EAAE,EAAR;AACD;;AACD,WAAKxE,UAAL,CAAgB+B,MAAhB,GAAyB,EAAE,KAAK2C,KAAhC;AACD,KARD;;AASA,SAAKG,QAAL,CAAcF,QAAd,EAAwB,CAAxB,EAA2BF,OAA3B;AACD,GAjMM;AAkMP;AACAlD,EAAAA,QAnMO,sBAmMI;AACT,SAAK5B,SAAL,CAAeqB,MAAf,GAAwB,IAAxB,CADS,CAET;;AACE,QAAIY,IAAI,GAAG5C,EAAE,CAAC8F,WAAH,CAAe,KAAKlF,WAApB,CAAX;AACAgC,IAAAA,IAAI,CAACmD,KAAL,GAAa,GAAb;AACAnD,IAAAA,IAAI,CAACoD,MAAL,GAAc,KAAKrF,SAAnB,CALO,CAMP;AACA;AACA;;AACA,SAAKkC,aAAL,CAAmBoD,IAAnB,CAAwBrD,IAAxB,EATO,CAUT;;AACA,QAAI8C,KAAK,GAAG,CAAZ;AACA9C,IAAAA,IAAI,CAACE,cAAL,CAAoB,OAApB,EAA6Bd,MAA7B,GAAsC,IAAtC;;AACA,QAAM2D,QAAQ,GAAG,SAAXA,QAAW,GAAY;AAC3BD,MAAAA,KAAK,KAAK,EAAV,IAAgB,KAAKE,UAAL,CAAgBD,QAAhB,CAAhB;AACA/C,MAAAA,IAAI,CAACE,cAAL,CAAoB,OAApB,EAA6BhB,YAA7B,CAA0C9B,EAAE,CAACO,KAA7C,EAAoDwC,MAApD,GAA6D2C,KAA7D;AACAA,MAAAA,KAAK;AACN,KAJD;;AAKA,SAAKG,QAAL,CAAcF,QAAd,EAAwB,GAAxB,EAA6B,EAA7B;AACD,GAtNM;;AAuNP;;;;AAIAO,EAAAA,aA3NO,2BA2NgB;AAAA,QAATC,GAAS,uEAAH,CAAG;AACrB,QAAI,CAAC,KAAKtD,aAAL,CAAmBuD,MAAxB,EAAgC;AAChC,QAAMC,UAAU,GAAG,KAAKxD,aAAL,CAAmB,CAAnB,EAAsBC,cAAtB,CAAqC,OAArC,EAA8ChB,YAA9C,CAA2D9B,EAAE,CAACO,KAA9D,CAAnB;AACA8F,IAAAA,UAAU,CAACtD,MAAX,IAAqBoD,GAArB;AACA,KAACG,MAAM,CAACD,UAAU,CAACtD,MAAZ,CAAP,IAA8B,KAAKpC,SAAL,CAAeiE,iBAAf,EAA9B;AACD,GAhOM;AAiOP;AACApB,EAAAA,aAlOO,+BAkO2B;AAAA,QAAnB+C,gBAAmB,QAAnBA,gBAAmB;AAChC,QAAMC,QAAQ,GAAGD,gBAAgB,CAAC,KAAK9D,MAAN,CAAjC;AACA,QAAMgE,KAAK,GAAG,KAAK5D,aAAnB;AACA,QAAI,CAAC2D,QAAD,IAAa,KAAK/D,MAAL,KAAgBC,qBAASC,UAAT,CAAoBF,MAArD,EAA6D;AAC7D+D,IAAAA,QAAQ,CAACE,IAAT,CAAc,UAACC,CAAD,EAAIC,CAAJ;AAAA,aAAUA,CAAC,CAACC,GAAF,GAAQF,CAAC,CAACE,GAApB;AAAA,KAAd;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,QAAQ,CAACJ,MAA7B,EAAqCU,CAAC,EAAtC,EAA0C;AACxC,UAAIlE,IAAI,GAAG6D,KAAK,CAACK,CAAD,CAAhB,CADwC,CAExC;;AACA,UAAIlE,IAAJ,EAAU;AACRA,QAAAA,IAAI,CAACE,cAAL,CAAoB,OAApB,EAA6BhB,YAA7B,CAA0C9B,EAAE,CAACO,KAA7C,EAAoDwC,MAApD,GAA6D,EAA7D;AACD,OAFD,MAEO;AACLH,QAAAA,IAAI,GAAG5C,EAAE,CAAC8F,WAAH,CAAe,KAAKlF,WAApB,CAAP;AACAgC,QAAAA,IAAI,CAACmD,KAAL,GAAa,GAAb;AACAnD,QAAAA,IAAI,CAACoD,MAAL,GAAc,KAAKrF,SAAnB;AACA8F,QAAAA,KAAK,CAACR,IAAN,CAAWrD,IAAX;AACD;;AACDA,MAAAA,IAAI,CAACd,YAAL,CAAkB,MAAlB,EAA0BiF,SAA1B,CAAoCP,QAAQ,CAACM,CAAD,CAA5C,EAAiD,KAAKrE,MAAtD;AACD;AACF,GApPM;AAqPP;AACAoC,EAAAA,YAtPO,0BAsPQ;AACb,QAAImC,gBAAgB,GAAG,KAAKpF,YAAL,EAAvB;AACA,QAAIqF,YAAY,GAAGD,gBAAgB,CAACE,0BAAjB,CAA4C,KAAKzE,MAAjD,CAAnB;AACA,QAAI0E,QAAQ,GAAGF,YAAY,CAACE,QAA5B;;AACA,SAAK,IAAIL,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGK,QAAQ,CAACf,MAA7B,EAAqCU,CAAC,EAAtC,EAA0C;AACxC,UAAIlE,IAAI,GAAGuE,QAAQ,CAACL,CAAD,CAAnB;AACAlE,MAAAA,IAAI,CAACwE,OAAL;AACD;;AACDH,IAAAA,YAAY,CAACrC,iBAAb,CAA+B,IAA/B;AACD;AA/PM,CAAT","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs","sourcesContent":["import myglobal from \"../../mygolbal.js\"\r\nconst ddzConstants = require('ddzConstants')\r\nconst ddzData = require('ddzData')\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    headImage: cc.Sprite,\r\n    // account_label: cc.Label,\r\n    nickname_label: cc.Label,\r\n    // room_touxiang: cc.Sprite,\r\n    globalcount_label: cc.Label,\r\n    // headimage: cc.Sprite,\r\n    readyimage: cc.Node,\r\n    card_node: cc.Node, // 扑克牌节点\r\n    card_prefab: cc.Prefab,\r\n    //tips_label:cc.Label,\r\n    clockimage: cc.Node,\r\n    qiangdidzhu_node: cc.Node, //抢地主的父节点\r\n    time_label: cc.Label,\r\n    robimage_sp: cc.SpriteFrame,\r\n    robnoimage_sp: cc.SpriteFrame,\r\n    robIconSp: cc.Sprite,\r\n    robIcon_Sp: cc.Node,\r\n    robnoIcon_Sp: cc.Node,\r\n    masterIcon: cc.Node, // 地主标识节点\r\n    jiaodizhu: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    },\r\n    buqiang: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    }\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n  getGameScene() {\r\n    return cc.find('Canvas').getComponent('gameScene')\r\n  },\r\n  onLoad() {\r\n    this.readyimage.active = ddzData.gameState < ddzConstants.gameState.GAMESTART\r\n    this.masterIcon.active = false\r\n    //  准备开始\r\n    this.node.on(\"player_ready_notify\", () => {\r\n      this.readyimage.active = true\r\n    })\r\n    // 开始游戏(客户端发给客户端)\r\n    this.node.on(\"gamestart_event\", () => {\r\n      this.readyimage.active = false\r\n    })\r\n\r\n    //给其他玩家发牌事件\r\n    this.node.on(\"push_card_event\", function (event) {\r\n      if (this.seat_index === 0) return // 自己不再发牌\r\n      this.pushCard()\r\n    }.bind(this))\r\n    // this.node.on(\"playernode_rob_state_event\", function (event) {\r\n    //   // this.node.on(\"playernode_rob_state_event\", function (event) {\r\n    //   //{\"userId\":\"2162866\",\"state\":1}\r\n    //   var detail = event\r\n\r\n    //   //如果是自己在抢，需要隐藏qiangdidzhu_node节点\r\n    //   //this.userId表示这个节点挂接的userId\r\n    //   if (detail.userId == this.userId) {\r\n    //     this.qiangdidzhu_node.active = false\r\n    //   }\r\n    //   if (this.userId == detail.userId) {\r\n    //     if (detail.state == qian_state.qiang) {\r\n    //       console.log(\"this.robIcon_Sp.active = true\")\r\n    //       this.robIcon_Sp.active = true\r\n\r\n    //     } else if (detail.state == qian_state.buqiang) {\r\n    //       this.robnoIcon_Sp.active = true\r\n\r\n    //     } else {\r\n    //       console.log(\"get rob value :\" + detail.state)\r\n    //     }\r\n    //   }\r\n\r\n    // }.bind(this))\r\n\r\n    this.node.on(\"playernode_changemaster_event\", function (userId) {\r\n      this.robIcon_Sp.active = false\r\n      this.robnoIcon_Sp.active = false\r\n      if (userId !== this.userId) return\r\n      this.masterIcon.active = true\r\n      if (userId === myglobal.playerData.userId) return\r\n      const card = this.cardlist_node[0]\r\n      card && (card.getChildByName('count').getComponent(cc.Label).string = 20)\r\n    }.bind(this))\r\n\r\n    // this.node.on(\"playernode_add_three_card\",function(event){\r\n    //   var detail = event //地主的accountid\r\n    //   if(detail==this.userId){\r\n    //     //给地主发三张排\r\n\r\n    //   }\r\n    // }.bind(this))\r\n  },\r\n\r\n  start() {\r\n    // 监听游戏状态\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.addListener(this.gameStateHandler, this)\r\n    }\r\n    window.$socket.on('canrob_notify', this.canrobNotify, this) // 抢地主\r\n    window.$socket.on('gameEndNotify', this.gameEndNotify, this) // 游戏结束\r\n  },\r\n  onDestroy() {\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.removeListener(this.gameStateHandler, this)\r\n    }\r\n    window.$socket.remove('canrob_notify', this)\r\n    window.$socket.remove('gameEndNotify', this)\r\n  },\r\n  //这里初始化房间内位置节点信息(自己和其他玩家)\r\n  //data玩家节点数据\r\n  //index玩家在房间的位置索引\r\n  init_data(data, index) {\r\n    //data:{\"userId\":\"2117836\",\"userName\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}\r\n    this.userId = data.userId\r\n    // this.account_label.string = data.accountid\r\n    this.nickname_label.string = data.userName\r\n    this.globalcount_label.string = data.goldcount\r\n    this.cardlist_node = []\r\n    this.seat_index = index\r\n    //这里根据传入的avarter来获取本地图像\r\n    var head_image_path = \"UI/headimage/\" + data.avatarUrl\r\n    cc.loader.loadRes(head_image_path, cc.SpriteFrame, function (err, spriteFrame) {\r\n      if (err) {\r\n        console.log(err.message || err);\r\n        return;\r\n      }\r\n      this.headImage.spriteFrame = spriteFrame;\r\n    }.bind(this));\r\n    if (!index) {\r\n      this.readyimage.active = false\r\n      return\r\n    }\r\n    // 更改右边机器人的扑克牌位置\r\n    if (index === 1) {\r\n      this.card_node.x = -this.card_node.x\r\n    }\r\n  },\r\n  gameStateHandler(state) {\r\n    // 开始游戏 - 已准备\r\n    if (state === ddzConstants.gameState.GAMESTART) {\r\n      // const cards = this.cardlist_node\r\n      // for (let i = 0; i < cards.length; i++) {\r\n      //   if (!cards[i]) break\r\n      //   cards[i].destroy()\r\n      //   cards.splice(i, 1)\r\n      // }\r\n      this.cardlist_node = []\r\n      this.card_node.removeAllChildren()\r\n      this.clearOutZone()\r\n      this.masterIcon.active = false // 隐藏地主标识 \r\n    }\r\n  },\r\n  // 抢地主通知\r\n  canrobNotify(landlordId) {\r\n    if (landlordId === this.userId && landlordId !== myglobal.playerData.userId) {\r\n      this.robIcon_Sp.active = false\r\n      this.robnoIcon_Sp.active = false\r\n      const isQdz = common.random(0, 10) > 5 // 是否抢地主\r\n      this.schedulerOnce(() => {\r\n        isQdz && (this.robIcon_Sp.active = true) // 抢\r\n        !isQdz && (this.robnoIcon_Sp.active = true) // 不抢\r\n        window.$socket.emit('canrob_state_notify', {\r\n          userId: this.userId,\r\n          state: isQdz ? qian_state.qiang : qian_state.buqiang\r\n        })\r\n        common.audio.PlayEffect(isQdz ? this.jiaodizhu : this.buqiang)\r\n      })\r\n    }\r\n  },\r\n  /**\r\n   * @description 开启一个十秒的闹钟定时器\r\n   * @param {function} fn 关闭后的回调函数\r\n   * @param {Number} seconds 几秒后关闭\r\n   */\r\n  schedulerOnce(fn, seconds = common.random(0, 10)) {\r\n    this.count = 10;\r\n    this.time_label.string = this.count\r\n    this.qiangdidzhu_node.active = true\r\n    const callback = function () {\r\n      if (!this.count || (10 - seconds) === this.count) {\r\n        // 在第六次执行回调时取消这个计时器\r\n        this.qiangdidzhu_node.active = false\r\n        this.unschedule(callback)\r\n        fn && fn()\r\n      }\r\n      this.time_label.string = --this.count\r\n    }\r\n    this.schedule(callback, 1, seconds)\r\n  },\r\n  // 给机器发牌\r\n  pushCard() {\r\n    this.card_node.active = true\r\n    // for (var i = 0; i < 17; i++) {\r\n      var card = cc.instantiate(this.card_prefab)\r\n      card.scale = 0.6\r\n      card.parent = this.card_node\r\n      // var height = card.height\r\n      // card.y = (17 - 1) * 0.5 * height * 0.4 * 0.3 - height * 0.4 * 0.3 * i;\r\n      // card.x = 0\r\n      this.cardlist_node.push(card)\r\n    // }\r\n    let count = 0;\r\n    card.getChildByName('count').active = true\r\n    const callback = function () {\r\n      count === 17 && this.unschedule(callback)\r\n      card.getChildByName('count').getComponent(cc.Label).string = count\r\n      count++;\r\n    }\r\n    this.schedule(callback, 0.1, 17);\r\n  },\r\n  /**\r\n   * @description 出牌后减少手牌节点\r\n   * @param {Number} len 需要减少的节点数量\r\n   */\r\n  subtractCards(len = 0) {\r\n    if (!this.cardlist_node.length) return\r\n    const countLabel = this.cardlist_node[0].getChildByName('count').getComponent(cc.Label)\r\n    countLabel.string -= len\r\n    !Number(countLabel.string) && this.card_node.removeAllChildren()\r\n  },\r\n  // 游戏结束显示剩余牌型\r\n  gameEndNotify({otherPlayerCards}) {\r\n    const cardList = otherPlayerCards[this.userId]\r\n    const cards = this.cardlist_node\r\n    if (!cardList || this.userId === myglobal.playerData.userId) return\r\n    cardList.sort((a, b) => b.val - a.val)\r\n    for (let i = 0; i < cardList.length; i++) {\r\n      let card = cards[i]\r\n      // card.y = (17 - 1) * 0.5 * card.height * 0.4 * 0.3 - card.height * 0.4 * 0.3 * i;\r\n      if (card) {\r\n        card.getChildByName('count').getComponent(cc.Label).string = ''\r\n      } else {\r\n        card = cc.instantiate(this.card_prefab)\r\n        card.scale = 0.6\r\n        card.parent = this.card_node\r\n        cards.push(card)\r\n      }\r\n      card.getComponent(\"card\").showCards(cardList[i], this.userId)\r\n    }\r\n  },\r\n  //清除显示出牌节点全部子节点(就是把出牌的清空)\r\n  clearOutZone() {\r\n    var gameScene_script = this.getGameScene()\r\n    var outCard_node = gameScene_script.getUserOutCardPosByAccount(this.userId)\r\n    var children = outCard_node.children;\r\n    for (var i = 0; i < children.length; i++) {\r\n      var card = children[i];\r\n      card.destroy()\r\n    }\r\n    outCard_node.removeAllChildren(true);\r\n  },\r\n});\r\n"]}