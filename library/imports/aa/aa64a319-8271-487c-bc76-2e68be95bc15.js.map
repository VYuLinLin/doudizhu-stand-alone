{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs/assets\\scripts\\gameScene\\prefabs\\player_node.js"],"names":["ddzConstants","require","ddzData","cc","Class","Component","properties","headImage","Sprite","account_label","Label","nickname_label","globalcount_label","readyimage","Node","offlineimage","card_node","card_prefab","Prefab","clockimage","qiangdidzhu_node","time_label","robimage_sp","SpriteFrame","robnoimage_sp","robIconSp","robIcon_Sp","robnoIcon_Sp","masterIcon","onLoad","active","gameState","GAMESTART","node","on","event","seat_index","pushCard","bind","detail","accountid","state","qian_state","qian","console","log","buqiang","start","init_data","data","index","string","userName","goldcount","cardlist_node","head_image_path","avatarUrl","loader","loadRes","err","spriteFrame","message","x","i","card","instantiate","scale","parent","name","height","y","push"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs","sourcesContent":["import myglobal from \"../../mygolbal.js\"\r\nconst ddzConstants = require('ddzConstants')\r\nconst ddzData = require('ddzData')\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    headImage: cc.Sprite,\r\n    account_label: cc.Label,\r\n    nickname_label: cc.Label,\r\n    // room_touxiang: cc.Sprite,\r\n    globalcount_label: cc.Label,\r\n    // headimage: cc.Sprite,\r\n    readyimage: cc.Node,\r\n    offlineimage: cc.Node,\r\n    card_node: cc.Node,\r\n    card_prefab: cc.Prefab,\r\n    //tips_label:cc.Label,\r\n    clockimage: cc.Node,\r\n    qiangdidzhu_node: cc.Node, //抢地主的父节点\r\n    time_label: cc.Label,\r\n    robimage_sp: cc.SpriteFrame,\r\n    robnoimage_sp: cc.SpriteFrame,\r\n    robIconSp: cc.Sprite,\r\n    robIcon_Sp: cc.Node,\r\n    robnoIcon_Sp: cc.Node,\r\n    masterIcon: cc.Node,\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad() {\r\n    this.readyimage.active = ddzData.gameState < ddzConstants.gameState.GAMESTART\r\n    this.offlineimage.active = false\r\n    //  准备开始\r\n    this.node.on(\"player_ready_notify\", () => {\r\n      this.readyimage.active = true\r\n    })\r\n    // 开始游戏(客户端发给客户端)\r\n    this.node.on(\"gamestart_event\", () => {\r\n      this.readyimage.active = false\r\n    })\r\n\r\n    //给其他玩家发牌事件\r\n    this.node.on(\"push_card_event\", function (event) {\r\n      if (this.seat_index === 0) return // 自己不再发牌\r\n      this.pushCard()\r\n    }.bind(this))\r\n\r\n    this.node.on(\"playernode_rob_state_event\", function (event) {\r\n      //{\"accountid\":\"2162866\",\"state\":1}\r\n      var detail = event\r\n\r\n      //如果是自己在抢，需要隐藏qiangdidzhu_node节点\r\n      //this.accountid表示这个节点挂接的accountid\r\n      if (detail.accountid == this.accountid) {\r\n        //console.log(\"detail.accountid\"+detail.accountid)\r\n        this.qiangdidzhu_node.active = false\r\n\r\n      }\r\n\r\n      if (this.accountid == detail.accountid) {\r\n        if (detail.state == qian_state.qian) {\r\n\r\n          console.log(\"this.robIcon_Sp.active = true\")\r\n          this.robIcon_Sp.active = true\r\n\r\n        } else if (detail.state == qian_state.buqiang) {\r\n          this.robnoIcon_Sp.active = true\r\n\r\n        } else {\r\n          console.log(\"get rob value :\" + detail.state)\r\n        }\r\n      }\r\n\r\n    }.bind(this))\r\n\r\n    this.node.on(\"playernode_changemaster_event\", function (event) {\r\n      var detail = event\r\n      this.robIcon_Sp.active = false\r\n      this.robnoIcon_Sp.active = false\r\n      if (detail == this.accountid) {\r\n        this.masterIcon.active = true\r\n      }\r\n    }.bind(this))\r\n\r\n    // this.node.on(\"playernode_add_three_card\",function(event){\r\n    //   var detail = event //地主的accountid\r\n    //   if(detail==this.accountid){\r\n    //     //给地主发三张排\r\n\r\n    //   }\r\n    // }.bind(this))\r\n  },\r\n\r\n  start() {\r\n\r\n  },\r\n\r\n  //这里初始化房间内位置节点信息(自己和其他玩家)\r\n  //data玩家节点数据\r\n  //index玩家在房间的位置索引\r\n  init_data(data, index) {\r\n    // console.log(\"init_data:\" + JSON.stringify(data))\r\n    //data:{\"accountid\":\"2117836\",\"userName\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}\r\n    this.accountid = data.accountid\r\n    this.account_label.string = data.accountid\r\n    this.nickname_label.string = data.userName\r\n    this.globalcount_label.string = data.goldcount\r\n    this.cardlist_node = []\r\n    this.seat_index = index\r\n    if (!index) {\r\n      this.readyimage.active = false\r\n    }\r\n    //网络图片加载\r\n    // cc.loader.loadRes(data.avatarUrl, cc.SpriteFrame, (err, tex) => {\r\n    //   //cc.log('Should load a texture from RESTful API by specify the type: ' + (tex instanceof cc.Texture2D));\r\n    //   // let oldWidth = this.headImage.node.width;\r\n    //   //console.log('old withd' + oeldWidth);\r\n    //   if (err) return console.log(err)\r\n    //   this.headImage.spriteFrame = tex\r\n    //   // let newWidth = this.headImage.node.width;\r\n    //   //console.log('old withd' + newWidth);\r\n    //   // this.headImage.node.scale = oldWidth / newWidth;\r\n    // });\r\n    //这里根据传入的avarter来获取本地图像\r\n    //console.log(str)\r\n    var head_image_path = \"UI/headimage/\" + data.avatarUrl\r\n    cc.loader.loadRes(head_image_path, cc.SpriteFrame, function (err, spriteFrame) {\r\n      if (err) {\r\n        console.log(err.message || err);\r\n        return;\r\n      }\r\n      this.headImage.spriteFrame = spriteFrame;\r\n    }.bind(this));\r\n\r\n    //监听内部随可以抢地主消息,这个消息会发给每个playernode节点\r\n    this.node.on(\"playernode_canrob_event\", function (event) {\r\n      var detail = event\r\n      console.log(\"------playernode_canrob_event detail:\" + detail)\r\n      if (detail == this.accountid) {\r\n        this.qiangdidzhu_node.active = true\r\n        //this.tips_label.string =\"正在抢地主\" \r\n        this.time_label.string = \"10\"\r\n        //开启一个定时器\r\n\r\n      }\r\n    }.bind(this))\r\n    // 更改右边机器人的扑克牌位置\r\n    if (index == 1) {\r\n      this.card_node.x = -this.card_node.x\r\n    }\r\n  },\r\n\r\n  pushCard() {\r\n    this.card_node.active = true\r\n    for (var i = 0; i < 17; i++) {\r\n      var card = cc.instantiate(this.card_prefab)\r\n      card.scale = 0.6\r\n      console.log(\" this.card_node.parent.parent\" + this.card_node.parent.parent.name)\r\n      card.parent = this.card_node\r\n      var height = card.height\r\n      card.y = (17 - 1) * 0.5 * height * 0.4 * 0.3 - height * 0.4 * 0.3 * i;\r\n      card.x = 0\r\n      this.cardlist_node.push(card)\r\n    }\r\n  },\r\n});\r\n"]}