{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs/assets\\scripts\\gameScene\\prefabs\\player_node.js"],"names":["cc","Class","Component","properties","account_label","Label","nickname_label","room_touxiang","Sprite","globalcount_label","headimage","readyimage","Node","offlineimage","card_node","card_prefab","Prefab","clockimage","qiangdidzhu_node","time_label","robimage_sp","SpriteFrame","robnoimage_sp","robIconSp","robIcon_Sp","robnoIcon_Sp","masterIcon","onLoad","active","node","on","event","bind","console","log","accountid","myglobal","playerData","accountID","pushCard","detail","state","qian_state","qian","buqiang","start","init_data","data","index","JSON","stringify","string","nick_name","goldcount","cardlist_node","seat_index","isready","str","avatarUrl","head_image_path","loader","loadRes","err","spriteFrame","message","x","i","card","instantiate","scale","parent","name","height","y","push"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs","sourcesContent":["import myglobal from \"../../mygolbal.js\"\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        account_label:cc.Label,\r\n        nickname_label:cc.Label,\r\n        room_touxiang:cc.Sprite,\r\n        globalcount_label:cc.Label,\r\n        headimage:cc.Sprite,\r\n        readyimage:cc.Node,\r\n        offlineimage:cc.Node,\r\n        card_node:cc.Node,\r\n        card_prefab:cc.Prefab,\r\n        //tips_label:cc.Label,\r\n        clockimage:cc.Node,\r\n        qiangdidzhu_node:cc.Node, //抢地主的父节点\r\n        time_label:cc.Label,\r\n        robimage_sp:cc.SpriteFrame,\r\n        robnoimage_sp:cc.SpriteFrame,\r\n        robIconSp: cc.Sprite,\r\n        robIcon_Sp:cc.Node,\r\n        robnoIcon_Sp:cc.Node,\r\n        masterIcon:cc.Node,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n      this.readyimage.active = false\r\n      this.offlineimage.active = false\r\n      \r\n      //监听开始游戏事件(客户端发给客户端)\r\n      this.node.on(\"gamestart_event\",function(event){\r\n        this.readyimage.active = false\r\n      }.bind(this))\r\n\r\n      //给其他玩家发牌事件\r\n      this.node.on(\"push_card_event\",function(event){\r\n        console.log(\"on push_card_event\")\r\n        //自己不再发牌\r\n        if(this.accountid==myglobal.playerData.accountID){\r\n            return\r\n        }\r\n        this.pushCard()\r\n      }.bind(this))\r\n\r\n      this.node.on(\"playernode_rob_state_event\",function(event){\r\n          //{\"accountid\":\"2162866\",\"state\":1}\r\n          var detail = event\r\n      \r\n          //如果是自己在抢，需要隐藏qiangdidzhu_node节点\r\n          //this.accountid表示这个节点挂接的accountid\r\n          if(detail.accountid==this.accountid){\r\n            //console.log(\"detail.accountid\"+detail.accountid)\r\n            this.qiangdidzhu_node.active = false\r\n              \r\n          }\r\n\r\n          if(this.accountid == detail.accountid){\r\n            if(detail.state==qian_state.qian){\r\n             \r\n              console.log(\"this.robIcon_Sp.active = true\")\r\n              this.robIcon_Sp.active = true\r\n\r\n            }else if(detail.state==qian_state.buqiang){\r\n              this.robnoIcon_Sp.active = true\r\n             \r\n            }else{\r\n              console.log(\"get rob value :\"+detail.state)\r\n            }\r\n          }\r\n         \r\n      }.bind(this))\r\n\r\n      this.node.on(\"playernode_changemaster_event\",function(event){\r\n         var detail = event \r\n         this.robIcon_Sp.active = false\r\n         this.robnoIcon_Sp.active = false\r\n         if(detail==this.accountid){\r\n            this.masterIcon.active = true\r\n          }\r\n      }.bind(this))\r\n\r\n      // this.node.on(\"playernode_add_three_card\",function(event){\r\n      //   var detail = event //地主的accountid\r\n      //   if(detail==this.accountid){\r\n      //     //给地主发三张排\r\n\r\n      //   }\r\n      // }.bind(this))\r\n    },\r\n\r\n    start () {\r\n        \r\n    },\r\n\r\n    //这里初始化房间内位置节点信息(自己和其他玩家)\r\n    //data玩家节点数据\r\n    //index玩家在房间的位置索引\r\n    init_data(data,index){\r\n      console.log(\"init_data:\"+JSON.stringify(data))  \r\n      //data:{\"accountid\":\"2117836\",\"nick_name\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}\r\n      this.accountid = data.accountid\r\n      this.account_label.string = data.accountid\r\n      this.nickname_label.string = data.nick_name\r\n      this.globalcount_label.string = data.goldcount\r\n      this.cardlist_node = []\r\n      this.seat_index = index\r\n      if(data.isready==true){\r\n        this.readyimage.active = true\r\n      }\r\n\r\n      //网络图片加载\r\n    //     cc.loader.load({url: data.avatarUrl, type: 'jpg'},  (err, tex)=> {\r\n    //     //cc.log('Should load a texture from RESTful API by specify the type: ' + (tex instanceof cc.Texture2D));\r\n    //     let oldWidth = this.headImage.node.width;\r\n    //     //console.log('old withd' + oldWidth);\r\n    //     this.room_touxiang.spriteFrame = new cc.SpriteFrame(tex);\r\n    //     let newWidth = this.headImage.node.width;\r\n    //     //console.log('old withd' + newWidth);\r\n    //     this.headImage.node.scale = oldWidth / newWidth;\r\n    // });\r\n    //这里根据传入的avarter来获取本地图像\r\n    var str = data.avatarUrl\r\n    //console.log(str)\r\n    var head_image_path = \"UI/headimage/\" + str\r\n    cc.loader.loadRes(head_image_path,cc.SpriteFrame,function(err,spriteFrame) {\r\n        if (err) {\r\n            console.log(err.message || err);\r\n            return;\r\n        }          \r\n         this.headimage.spriteFrame = spriteFrame;        \r\n        }.bind(this));\r\n\r\n    //注册一个player_ready消息\r\n    this.node.on(\"player_ready_notify\",function(event){\r\n        console.log(\"player_ready_notify event\",event)\r\n            var detail = event\r\n            console.log(\"------player_ready_notify detail:\"+detail)\r\n            if(detail==this.accountid){\r\n                this.readyimage.active = true\r\n            }\r\n        }.bind(this))\r\n\r\n        //监听内部随可以抢地主消息,这个消息会发给每个playernode节点\r\n        this.node.on(\"playernode_canrob_event\",function(event){\r\n            var detail = event\r\n            console.log(\"------playernode_canrob_event detail:\"+detail)\r\n            if(detail==this.accountid){\r\n              this.qiangdidzhu_node.active=true\r\n              //this.tips_label.string =\"正在抢地主\" \r\n              this.time_label.string=\"10\"\r\n              //开启一个定时器\r\n\r\n            }\r\n        }.bind(this))\r\n        //?\r\n        if(index==1){\r\n          this.card_node.x = -this.card_node.x - 30\r\n        }\r\n    },\r\n\r\n    // update (dt) {},\r\n    pushCard(){\r\n        \r\n        this.card_node.active = true \r\n        for(var i=0;i<17;i++){\r\n            var card = cc.instantiate(this.card_prefab)\r\n            card.scale=0.6\r\n            console.log(\" this.card_node.parent.parent\"+ this.card_node.parent.parent.name)\r\n            card.parent = this.card_node\r\n            //card.parent = this.node\r\n            var height = card.height\r\n            card.y = (17 - 1) * 0.5 * height * 0.4 * 0.3 - height * 0.4 * 0.3 * i;\r\n            card.x = 0\r\n           \r\n            //console.log(\"call pushCard x:\"+card.x+\" y:\"+card.y)\r\n            this.cardlist_node.push(card)\r\n        }\r\n    },\r\n});\r\n"]}