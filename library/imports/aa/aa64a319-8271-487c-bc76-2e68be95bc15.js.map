{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs/assets\\scripts\\gameScene\\prefabs\\player_node.js"],"names":["ddzConstants","require","ddzData","cc","Class","Component","properties","headImage","Sprite","nickname_label","Label","globalcount_label","readyimage","Node","card_node","card_prefab","Prefab","clockimage","qiangdidzhu_node","time_label","robimage_sp","SpriteFrame","robnoimage_sp","robIcon_Sp","robnoIcon_Sp","masterIcon","jiaodizhu","type","AudioClip","buqiang","getGameScene","find","getComponent","onLoad","active","node","on","event","seat_index","pushCard","bind","userId","myglobal","playerData","card","cardlist_node","getChildByName","string","start","CC_EDITOR","gameStateNotify","addListener","gameStateHandler","window","$socket","canrobNotify","gameEndNotify","onDestroy","removeListener","remove","init_data","data","index","userName","goldcount","head_image_path","avatarUrl","loader","loadRes","err","spriteFrame","console","log","message","x","state","gameState","GAMESTART","removeAllChildren","clearOutZone","landlordId","isQdz","common","random","schedulerOnce","emit","qian_state","qiang","audio","PlayEffect","fn","seconds","count","callback","unschedule","schedule","instantiate","scale","parent","push","subtractCards","len","length","countLabel","Number","otherPlayerCards","cardList","cards","sort","a","b","val","i","showCards","gameScene_script","outCard_node","getUserOutCardPosByAccount","children","destroy"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\scripts\\gameScene\\prefabs","sourcesContent":["import myglobal from \"../../mygolbal.js\"\r\nconst ddzConstants = require('ddzConstants')\r\nconst ddzData = require('ddzData')\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    headImage: cc.Sprite,\r\n    // account_label: cc.Label,\r\n    nickname_label: cc.Label,\r\n    // room_touxiang: cc.Sprite,\r\n    globalcount_label: cc.Label,\r\n    // headimage: cc.Sprite,\r\n    readyimage: cc.Node,\r\n    card_node: cc.Node, // 扑克牌节点\r\n    card_prefab: cc.Prefab,\r\n    //tips_label:cc.Label,\r\n    clockimage: cc.Node,\r\n    qiangdidzhu_node: cc.Node, //抢地主的父节点\r\n    time_label: cc.Label,\r\n    robimage_sp: cc.SpriteFrame,\r\n    robnoimage_sp: cc.SpriteFrame,\r\n    robIcon_Sp: cc.Node, // 抢地主\r\n    robnoIcon_Sp: cc.Node, // 不抢\r\n    masterIcon: cc.Node, // 地主标识节点\r\n    jiaodizhu: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    },\r\n    buqiang: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    }\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n  getGameScene() {\r\n    return cc.find('Canvas').getComponent('gameScene')\r\n  },\r\n  onLoad() {\r\n    this.masterIcon.active = false\r\n    //  准备开始\r\n    // this.node.on(\"player_ready_notify\", () => {\r\n    //   this.readyimage.active = true\r\n    // })\r\n    // 开始游戏(客户端发给客户端)\r\n    this.node.on(\"gamestart_event\", () => {\r\n      this.readyimage.active = false\r\n    })\r\n\r\n    //给其他玩家发牌事件\r\n    this.node.on(\"push_card_event\", function (event) {\r\n      if (this.seat_index === 0) return // 自己不再发牌\r\n      this.pushCard()\r\n    }.bind(this))\r\n    // this.node.on(\"playernode_rob_state_event\", function (event) {\r\n    //   // this.node.on(\"playernode_rob_state_event\", function (event) {\r\n    //   //{\"userId\":\"2162866\",\"state\":1}\r\n    //   var detail = event\r\n\r\n    //   //如果是自己在抢，需要隐藏qiangdidzhu_node节点\r\n    //   //this.userId表示这个节点挂接的userId\r\n    //   if (detail.userId == this.userId) {\r\n    //     this.qiangdidzhu_node.active = false\r\n    //   }\r\n    //   if (this.userId == detail.userId) {\r\n    //     if (detail.state == qian_state.qiang) {\r\n    //       console.log(\"this.robIcon_Sp.active = true\")\r\n    //       this.robIcon_Sp.active = true\r\n\r\n    //     } else if (detail.state == qian_state.buqiang) {\r\n    //       this.robnoIcon_Sp.active = true\r\n\r\n    //     } else {\r\n    //       console.log(\"get rob value :\" + detail.state)\r\n    //     }\r\n    //   }\r\n\r\n    // }.bind(this))\r\n\r\n    this.node.on(\"playernode_changemaster_event\", function (userId) {\r\n      this.robIcon_Sp.active = false\r\n      this.robnoIcon_Sp.active = false\r\n      if (userId !== this.userId) return\r\n      this.masterIcon.active = true\r\n      if (userId === myglobal.playerData.userId) return\r\n      const card = this.cardlist_node[0]\r\n      card && (card.getChildByName('count').getComponent(cc.Label).string = 20)\r\n    }.bind(this))\r\n\r\n    // this.node.on(\"playernode_add_three_card\",function(event){\r\n    //   var detail = event //地主的accountid\r\n    //   if(detail==this.userId){\r\n    //     //给地主发三张排\r\n\r\n    //   }\r\n    // }.bind(this))\r\n  },\r\n\r\n  start() {\r\n    // 监听游戏状态\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.addListener(this.gameStateHandler, this)\r\n    }\r\n    window.$socket.on('canrob_notify', this.canrobNotify, this) // 抢地主\r\n    window.$socket.on('gameEndNotify', this.gameEndNotify, this) // 游戏结束\r\n  },\r\n  onDestroy() {\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.removeListener(this.gameStateHandler, this)\r\n    }\r\n    window.$socket.remove('canrob_notify', this)\r\n    window.$socket.remove('gameEndNotify', this)\r\n  },\r\n  //这里初始化房间内位置节点信息(自己和其他玩家)\r\n  //data玩家节点数据\r\n  //index玩家在房间的位置索引\r\n  init_data(data, index) {\r\n    //data:{\"userId\":\"2117836\",\"userName\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}\r\n    this.userId = data.userId\r\n    // this.account_label.string = data.accountid\r\n    this.nickname_label.string = data.userName\r\n    this.globalcount_label.string = data.goldcount\r\n    this.cardlist_node = []\r\n    this.seat_index = index\r\n    //这里根据传入的avarter来获取本地图像\r\n    var head_image_path = \"UI/headimage/\" + data.avatarUrl\r\n    cc.loader.loadRes(head_image_path, cc.SpriteFrame, function (err, spriteFrame) {\r\n      if (err) {\r\n        console.log(err.message || err);\r\n        return;\r\n      }\r\n      this.headImage.spriteFrame = spriteFrame;\r\n    }.bind(this));\r\n    if (!index) {\r\n      this.readyimage.active = false\r\n      return\r\n    }\r\n    // 更改右边机器人的扑克牌位置\r\n    if (index === 1) {\r\n      this.card_node.x = -this.card_node.x\r\n    }\r\n  },\r\n  gameStateHandler(state) {\r\n    // 开始游戏 - 已准备\r\n    if (state === ddzConstants.gameState.GAMESTART) {\r\n      // const cards = this.cardlist_node\r\n      // for (let i = 0; i < cards.length; i++) {\r\n      //   if (!cards[i]) break\r\n      //   cards[i].destroy()\r\n      //   cards.splice(i, 1)\r\n      // }\r\n      this.cardlist_node = []\r\n      this.card_node.removeAllChildren()\r\n      this.clearOutZone()\r\n      this.masterIcon.active = false // 隐藏地主标识\r\n      this.readyimage.active = false\r\n      this.robIcon_Sp.active = false\r\n      this.robnoIcon_Sp.active = false\r\n    }\r\n  },\r\n  // 抢地主通知\r\n  canrobNotify(landlordId) {\r\n    if (landlordId === this.userId && landlordId !== myglobal.playerData.userId) {\r\n      this.robIcon_Sp.active = false\r\n      this.robnoIcon_Sp.active = false\r\n      const isQdz = common.random(0, 10) > 5 // 是否抢地主\r\n      this.schedulerOnce(() => {\r\n        isQdz && (this.robIcon_Sp.active = true) // 抢\r\n        !isQdz && (this.robnoIcon_Sp.active = true) // 不抢\r\n        window.$socket.emit('canrob_state_notify', {\r\n          userId: this.userId,\r\n          state: isQdz ? qian_state.qiang : qian_state.buqiang\r\n        })\r\n        common.audio.PlayEffect(isQdz ? this.jiaodizhu : this.buqiang)\r\n      })\r\n    }\r\n  },\r\n  /**\r\n   * @description 开启一个十秒的闹钟定时器\r\n   * @param {function} fn 关闭后的回调函数\r\n   * @param {Number} seconds 几秒后关闭\r\n   */\r\n  schedulerOnce(fn, seconds = common.random(0, 10)) {\r\n    this.count = 10;\r\n    this.time_label.string = this.count\r\n    this.qiangdidzhu_node.active = true\r\n    const callback = function () {\r\n      if (!this.count || (10 - seconds) === this.count) {\r\n        // 在第六次执行回调时取消这个计时器\r\n        this.qiangdidzhu_node.active = false\r\n        this.unschedule(callback)\r\n        fn && fn()\r\n      }\r\n      this.time_label.string = --this.count\r\n    }\r\n    this.schedule(callback, 1, seconds)\r\n  },\r\n  // 给机器发牌\r\n  pushCard() {\r\n    this.card_node.active = true\r\n    // for (var i = 0; i < 17; i++) {\r\n      var card = cc.instantiate(this.card_prefab)\r\n      card.scale = 0.6\r\n      card.parent = this.card_node\r\n      // var height = card.height\r\n      // card.y = (17 - 1) * 0.5 * height * 0.4 * 0.3 - height * 0.4 * 0.3 * i;\r\n      // card.x = 0\r\n      this.cardlist_node.push(card)\r\n    // }\r\n    let count = 0;\r\n    card.getChildByName('count').active = true\r\n    const callback = function () {\r\n      count === 17 && this.unschedule(callback)\r\n      card.getChildByName('count').getComponent(cc.Label).string = count\r\n      count++;\r\n    }\r\n    this.schedule(callback, 0.1, 17);\r\n  },\r\n  /**\r\n   * @description 出牌后减少手牌节点\r\n   * @param {Number} len 需要减少的节点数量\r\n   */\r\n  subtractCards(len = 0) {\r\n    if (!this.cardlist_node.length) return\r\n    const countLabel = this.cardlist_node[0].getChildByName('count').getComponent(cc.Label)\r\n    countLabel.string -= len\r\n    !Number(countLabel.string) && this.card_node.removeAllChildren()\r\n  },\r\n  // 游戏结束显示剩余牌型\r\n  gameEndNotify({otherPlayerCards}) {\r\n    const cardList = otherPlayerCards[this.userId]\r\n    const cards = this.cardlist_node\r\n    if (!cardList || this.userId === myglobal.playerData.userId) return\r\n    cardList.sort((a, b) => b.val - a.val)\r\n    for (let i = 0; i < cardList.length; i++) {\r\n      let card = cards[i]\r\n      // card.y = (17 - 1) * 0.5 * card.height * 0.4 * 0.3 - card.height * 0.4 * 0.3 * i;\r\n      if (card) {\r\n        card.getChildByName('count').getComponent(cc.Label).string = ''\r\n      } else {\r\n        card = cc.instantiate(this.card_prefab)\r\n        card.scale = 0.6\r\n        card.parent = this.card_node\r\n        cards.push(card)\r\n      }\r\n      card.getComponent(\"card\").showCards(cardList[i], this.userId)\r\n    }\r\n  },\r\n  //清除显示出牌节点全部子节点(就是把出牌的清空)\r\n  clearOutZone() {\r\n    var gameScene_script = this.getGameScene()\r\n    var outCard_node = gameScene_script.getUserOutCardPosByAccount(this.userId)\r\n    var children = outCard_node.children;\r\n    for (var i = 0; i < children.length; i++) {\r\n      var card = children[i];\r\n      card.destroy()\r\n    }\r\n    outCard_node.removeAllChildren(true);\r\n  },\r\n});\r\n"]}