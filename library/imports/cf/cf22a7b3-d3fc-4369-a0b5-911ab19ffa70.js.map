{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\gameScene/assets\\scripts\\gameScene\\gameScene.js"],"names":["ddzConstants","require","ddzData","cc","Class","Component","properties","bjMusic","type","AudioClip","di_label","Label","beishu_label","roomid_label","player_node_prefabs","Prefab","btn_ready","Node","players_seat_pos","gameUiNode","onLoad","gameState","WAITREADY","CC_EDITOR","gameStateNotify","addListener","gameStateHandler","playerNodeList","roomId","myglobal","playerData","split","rate","bottom","string","defines","roomNames","active","GAMESTART","isopen_sound","audioEngine","stopAll","addPlayerNode","rootList","node","on","console","log","i","length","emit","bind","socket","request_enter_room","err","result","JSON","stringify","seatid","seatindex","playerdata_list_pos","setPlayerSeatPos","playerdata_list","playerdata","housemanageid","gamebefore_node","getChildByName","onPlayerJoinRoom","join_playerdata","onPlayerReady","data","onGameStart","gamebeforeUI","onChangeMaster","event","masterUserId","start","$socket","masterNotify","onDestroy","removeListener","remove","masterId","cards","state","onGoback","INVALID","sys","localStorage","setItem","director","loadScene","onBtnReadey","forEach","player_data","index","playernode_inst","instantiate","parent","children","push","getComponent","init_data","getUserOutCardPosByAccount","userId","node_script","seat_node","seat_index","getUserNodeByAccount","playerNode"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\gameScene","sourcesContent":["import myglobal from \"../mygolbal.js\"\r\nconst ddzConstants = require('ddzConstants')\r\nconst ddzData = require('ddzData')\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n  properties: {\r\n    bjMusic: {\r\n      type: cc.AudioClip, // 背景音乐\r\n      default: null,     // object's default value is null\r\n    },\r\n    di_label: cc.Label,\r\n    beishu_label: cc.Label,\r\n    roomid_label: cc.Label,\r\n    player_node_prefabs: cc.Prefab,\r\n    btn_ready: cc.Node, // 准备按钮\r\n    //绑定玩家座位,下面有3个子节点\r\n    players_seat_pos: cc.Node,\r\n    gameUiNode: cc.Node\r\n  },\r\n  onLoad() {\r\n    ddzData.gameState = ddzConstants.gameState.WAITREADY\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.addListener(this.gameStateHandler, this)\r\n    }\r\n    this.playerNodeList = []\r\n    const { roomId } = myglobal.playerData\r\n    const [rate, bottom] = roomId.split('_')\r\n    myglobal.playerData.rate = rate\r\n    myglobal.playerData.bottom = bottom\r\n\r\n    this.roomid_label.string = defines.roomNames[rate - 1]\r\n    this.beishu_label.string = \"倍数：\" + rate\r\n    this.di_label.string = \"底：\" + bottom\r\n\r\n    this.btn_ready.active = ddzData.gameState < ddzConstants.gameState.GAMESTART // 准备按钮\r\n    if (isopen_sound) {\r\n      cc.audioEngine.stopAll()\r\n      // cc.audioEngine.play(this.bjMusic, true)\r\n    }\r\n    this.addPlayerNode(myglobal.playerData)\r\n    this.addPlayerNode(myglobal.playerData.rootList[0])\r\n    this.addPlayerNode(myglobal.playerData.rootList[1])\r\n    //监听，给其他玩家发牌(内部事件)\r\n    this.node.on(\"pushcard_other_event\", function () {\r\n      console.log('其他玩家发牌')\r\n      for (let i = 0; i < this.playerNodeList.length; i++) {\r\n        const node = this.playerNodeList[i]\r\n        if (node) {\r\n          //给playernode节点发送事件\r\n          node.emit(\"push_card_event\")\r\n        }\r\n      }\r\n    }.bind(this))\r\n\r\n    //监听房间状态改变事件\r\n    // myglobal.socket.onRoomChangeState(function (data) {\r\n    //   //回调的函数参数是进入房间用户消息\r\n    //   console.log(\"onRoomChangeState:\" + data)\r\n    //   this.roomstate = data\r\n    // }.bind(this))\r\n    // 抢地主\r\n    // this.node.on(\"canrob_event\", function (event) {\r\n    //   console.log(\"gamescene canrob_event:\" + event)\r\n    //   //通知给playernode子节点\r\n    //   for (var i = 0; i < this.playerNodeList.length; i++) {\r\n    //     var node = this.playerNodeList[i]\r\n    //     if (node) {\r\n    //       //给playernode节点发送事件\r\n    //       node.emit(\"playernode_canrob_event\", event)\r\n    //     }\r\n    //   }\r\n    // }.bind(this))\r\n\r\n    // this.node.on(\"choose_card_event\", function (event) {\r\n    //   this.gameUiNode.emit(\"choose_card_event\", event)\r\n    // }.bind(this))\r\n\r\n    // this.node.on(\"unchoose_card_event\", function (event) {\r\n    //   this.gameUiNode.emit(\"unchoose_card_event\", event)\r\n    // }.bind(this))\r\n    //监听给玩家添加三张底牌\r\n    // this.node.on(\"add_three_card\",function(event){\r\n    //     console.log(\"add_three_card:\"+event)\r\n    //     for(var i=0;i<this.playerNodeList.length;i++){\r\n    //         var node = this.playerNodeList[i]\r\n    //         if(node){\r\n    //             //给playernode节点发送事件\r\n    //             node.emit(\"playernode_add_three_card\",event)\r\n    //         }\r\n    //     }\r\n    // }.bind(this))\r\n    return\r\n\r\n    myglobal.socket.request_enter_room({}, function (err, result) {\r\n      console.log(\"enter_room_resp\" + JSON.stringify(result))\r\n      if (err != 0) {\r\n        console.log(\"enter_room_resp err:\" + err)\r\n      } else {\r\n\r\n        //enter_room成功\r\n        //notify ={\"seatid\":1,\"playerdata\":[{\"accountid\":\"2117836\",\"userName\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}]}\r\n        var seatid = result.seatindex //自己在房间里的seatid\r\n        this.playerdata_list_pos = []  //3个用户创建一个空用户列表\r\n        this.setPlayerSeatPos(seatid)\r\n\r\n        var playerdata_list = result.playerdata\r\n        var roomId = result.roomId\r\n        this.roomid_label.string = \"房间号:\" + roomId\r\n        myglobal.playerData.housemanageid = result.housemanageid\r\n\r\n        for (var i = 0; i < playerdata_list.length; i++) {\r\n          //consol.log(\"this----\"+this)\r\n          this.addPlayerNode(playerdata_list[i])\r\n        }\r\n\r\n\r\n      }\r\n      var gamebefore_node = this.node.getChildByName(\"gamebeforeUI\")\r\n      gamebefore_node.emit(\"init\")\r\n    }.bind(this))\r\n\r\n    //在进入房间后，注册其他玩家进入房间的事件\r\n    myglobal.socket.onPlayerJoinRoom(function (join_playerdata) {\r\n      //回调的函数参数是进入房间用户消息\r\n      console.log(\"onPlayerJoinRoom:\" + JSON.stringify(join_playerdata))\r\n      this.addPlayerNode(join_playerdata)\r\n    }.bind(this))\r\n\r\n    //回调参数是发送准备消息的accountid\r\n    myglobal.socket.onPlayerReady(function (data) {\r\n      console.log(\"-------onPlayerReady:\" + data)\r\n      for (var i = 0; i < this.playerNodeList.length; i++) {\r\n        var node = this.playerNodeList[i]\r\n        if (node) {\r\n          node.emit(\"player_ready_notify\", data)\r\n        }\r\n      }\r\n    }.bind(this))\r\n\r\n    myglobal.socket.onGameStart(function () {\r\n      for (var i = 0; i < this.playerNodeList.length; i++) {\r\n        var node = this.playerNodeList[i]\r\n        if (node) {\r\n          node.emit(\"gamestart_event\")\r\n        }\r\n      }\r\n\r\n      //隐藏gamebeforeUI节点\r\n      var gamebeforeUI = this.node.getChildByName(\"gamebeforeUI\")\r\n      if (gamebeforeUI) {\r\n        gamebeforeUI.active = false\r\n      }\r\n    }.bind(this))\r\n\r\n    //监听服务器玩家抢地主消息\r\n    // myglobal.socket.onRobState(function (event) {\r\n    //   console.log(\"-----onRobState\" + JSON.stringify(event))\r\n    //   //onRobState{\"accountid\":\"2162866\",\"state\":1}\r\n    //   for (var i = 0; i < this.playerNodeList.length; i++) {\r\n    //     var node = this.playerNodeList[i]\r\n    //     if (node) {\r\n    //       //给playernode节点发送事件\r\n    //       node.emit(\"playernode_rob_state_event\", event)\r\n    //     }\r\n    //   }\r\n    // }.bind(this))\r\n\r\n    //注册监听服务器确定地主消息\r\n    myglobal.socket.onChangeMaster(function (event) {\r\n      console.log(\"onChangeMaster\" + event)\r\n      //保存一下地主id\r\n      myglobal.playerData.masterUserId = event\r\n      for (var i = 0; i < this.playerNodeList.length; i++) {\r\n        var node = this.playerNodeList[i]\r\n        if (node) {\r\n          //给playernode节点发送事件\r\n          node.emit(\"playernode_changemaster_event\", event)\r\n        }\r\n      }\r\n    }.bind(this))\r\n\r\n    //注册监听服务器显示底牌消息\r\n    // myglobal.socket.onShowBottomCard(function (event) {\r\n    //   console.log(\"onShowBottomCard---------\" + event)\r\n    //   this.gameUiNode.emit(\"show_bottom_card_event\", event)\r\n    // }.bind(this))\r\n  },\r\n  start() {\r\n    $socket.on('change_master_notify', this.masterNotify, this)\r\n  },\r\n  onDestroy() {\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.removeListener(this.gameStateHandler, this)\r\n    }\r\n    $socket.remove('change_master_notify', this)\r\n  },\r\n  // 通知谁是地主, 并显示底牌\r\n  masterNotify({ masterId, cards }) {\r\n    // 必须先设置全局地主id\r\n    myglobal.playerData.masterUserId = masterId\r\n    // 显示底牌\r\n    this.gameUiNode.emit(\"show_bottom_card_event\", cards)\r\n    for (var i = 0; i < this.playerNodeList.length; i++) {\r\n      var node = this.playerNodeList[i]\r\n      if (node) {\r\n        // 给playernode节点发送事件\r\n        node.emit(\"playernode_changemaster_event\", masterId)\r\n      }\r\n    }\r\n  },\r\n  gameStateHandler(state) {\r\n    if (state === ddzConstants.gameState.WAITREADY) {\r\n      this.btn_ready.active = true\r\n    }\r\n  },\r\n  // 返回大厅\r\n  onGoback() {\r\n    ddzData.gameState = ddzConstants.gameState.INVALID\r\n    myglobal.playerData.roomId = ''\r\n    cc.sys.localStorage.setItem('userData', JSON.stringify(myglobal.playerData))\r\n    cc.director.loadScene(\"hallScene\")\r\n  },\r\n  // 准备\r\n  onBtnReadey(event) {\r\n    this.btn_ready.active = false\r\n    this.playerNodeList.forEach(node => {\r\n      node.emit(\"gamestart_event\")\r\n    });\r\n    ddzData.gameState = ddzConstants.gameState.GAMESTART\r\n  },\r\n  //seat_index自己在房间的位置id\r\n  // setPlayerSeatPos(seat_index) {\r\n  //   if (seat_index < 1 || seat_index > 3) {\r\n  //     console.log(\"seat_index error\" + seat_index)\r\n  //     return\r\n  //   }\r\n\r\n  //   console.log(\"setPlayerSeatPos seat_index:\" + seat_index)\r\n\r\n  //   //界面位置转化成逻辑位置\r\n  //   switch (seat_index) {\r\n  //     case 1:\r\n  //       this.playerdata_list_pos[1] = 0\r\n  //       this.playerdata_list_pos[2] = 1\r\n  //       this.playerdata_list_pos[3] = 2\r\n  //       break\r\n  //     case 2:\r\n\r\n\r\n  //       this.playerdata_list_pos[2] = 0\r\n  //       this.playerdata_list_pos[3] = 1\r\n  //       this.playerdata_list_pos[1] = 2\r\n  //       break\r\n  //     case 3:\r\n  //       this.playerdata_list_pos[3] = 0\r\n  //       this.playerdata_list_pos[1] = 1\r\n  //       this.playerdata_list_pos[2] = 2\r\n  //       break\r\n  //     default:\r\n  //       break\r\n  //   }\r\n  // },\r\n  // 添加玩家节点\r\n  addPlayerNode(player_data) {\r\n    var index = player_data.seatindex\r\n    var playernode_inst = cc.instantiate(this.player_node_prefabs)\r\n    playernode_inst.parent = this.players_seat_pos.children[index]\r\n    // playernode_inst.parent = this.node\r\n    //创建的节点存储在gamescene的列表中\r\n    this.playerNodeList.push(playernode_inst)\r\n\r\n    //玩家在room里的位置索引(逻辑位置)\r\n    // playernode_inst.position = this.players_seat_pos.children[index].position\r\n    playernode_inst.getComponent(\"player_node\").init_data(player_data, index)\r\n\r\n    // myglobal.playerData.playerList[index] = player_data\r\n  },\r\n\r\n  /*\r\n   //通过userId获取用户出牌放在gamescend的位置 \r\n   做法：先放3个节点在gameacene的场景中 cardsoutzone(012)\r\n  */\r\n  getUserOutCardPosByAccount(userId) {\r\n    for (var i = 0; i < this.playerNodeList.length; i++) {\r\n      var node = this.playerNodeList[i]\r\n      if (node) {\r\n        //获取节点绑定的组件\r\n        var node_script = node.getComponent(\"player_node\")\r\n        //如果accountid和player_node节点绑定的accountid相同\r\n        //接获取player_node的子节点\r\n        if (node_script.userId === userId) {\r\n          var seat_node = this.players_seat_pos.children[node_script.seat_index].getChildByName('cardsoutzone')\r\n          return seat_node\r\n        }\r\n      }\r\n    }\r\n    return null\r\n  },\r\n  /**\r\n    * @description 通过userId获取玩家头像节点 \r\n    * @param {String} userId \r\n    * @returns {cc.Node} 玩家节点\r\n    */\r\n  getUserNodeByAccount(userId) {\r\n    for (let i = 0; i < this.playerNodeList.length; i++) {\r\n      const node = this.playerNodeList[i]\r\n      if (node) {\r\n        //获取节点绑定的组件\r\n        const playerNode = node.getComponent(\"player_node\")\r\n        if (playerNode.userId === userId) return playerNode\r\n      }\r\n    }\r\n    return null\r\n  }\r\n});\r\n"]}