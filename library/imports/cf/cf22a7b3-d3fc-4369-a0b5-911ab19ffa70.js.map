{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\gameScene/assets\\scripts\\gameScene\\gameScene.js"],"names":["cc","Class","Component","properties","di_label","Label","beishu_label","roomid_label","player_node_prefabs","Prefab","players_seat_pos","Node","gameEnd","onLoad","playerNodeList","string","myglobal","playerData","bottom","rate","roomstate","RoomState","ROOM_INVALID","node","on","console","log","i","length","emit","bind","socket","onRoomChangeState","data","event","gameui_node","getChildByName","request_enter_room","err","result","JSON","stringify","seatid","seatindex","playerdata_list_pos","setPlayerSeatPos","playerdata_list","playerdata","roomid","housemanageid","addPlayerNode","isopen_sound","audioEngine","stopAll","play","url","raw","gamebefore_node","onPlayerJoinRoom","join_playerdata","onPlayerReady","onGameStart","gamebeforeUI","active","onRobState","onChangeMaster","master_accountid","onShowBottomCard","seat_index","player_data","playernode_inst","instantiate","parent","push","index","position","children","getComponent","init_data","start","getUserOutCardPosByAccount","accountid","node_script","seat_node","index_name","out_card_node"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\gameScene","sourcesContent":["import myglobal from \"../mygolbal.js\"\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        di_label:cc.Label,\r\n        beishu_label:cc.Label,\r\n        roomid_label:cc.Label,\r\n        player_node_prefabs:cc.Prefab,\r\n        //绑定玩家座位,下面有3个子节点\r\n        players_seat_pos:cc.Node,\r\n\r\n    },\r\n    //本局结束，做状态清除\r\n    gameEnd(){\r\n\r\n    },\r\n    onLoad () {\r\n        this.playerNodeList = []\r\n        this.di_label.string = \"底:\" +  myglobal.playerData.bottom\r\n        this.beishu_label.string = \"倍数:\" + myglobal.playerData.rate\r\n        this.roomstate = RoomState.ROOM_INVALID\r\n        //监听，给其他玩家发牌(内部事件)\r\n        this.node.on(\"pushcard_other_event\",function(){\r\n            console.log(\"gamescene pushcard_other_event\")\r\n            for(var i=0;i<this.playerNodeList.length;i++){\r\n                    var node = this.playerNodeList[i]\r\n                    if(node){\r\n                    //给playernode节点发送事件\r\n                        node.emit(\"push_card_event\")\r\n                    }\r\n            }\r\n        }.bind(this))\r\n\r\n        //监听房间状态改变事件\r\n        myglobal.socket.onRoomChangeState(function(data){\r\n            //回调的函数参数是进入房间用户消息\r\n            console.log(\"onRoomChangeState:\"+data)\r\n            this.roomstate = data\r\n        }.bind(this))\r\n        //\r\n        this.node.on(\"canrob_event\",function(event){\r\n            console.log(\"gamescene canrob_event:\"+event)\r\n            //通知给playernode子节点\r\n            for(var i=0;i<this.playerNodeList.length;i++){\r\n                var node = this.playerNodeList[i]\r\n                if(node){\r\n                    //给playernode节点发送事件\r\n                    node.emit(\"playernode_canrob_event\",event)\r\n                }\r\n            }\r\n        }.bind(this))\r\n\r\n        this.node.on(\"choose_card_event\",function(event){\r\n            console.log(\"--------choose_card_event-----------\")\r\n            var gameui_node =  this.node.getChildByName(\"gameingUI\")\r\n            if(gameui_node==null){\r\n               console.log(\"get childer name gameingUI\")\r\n               return\r\n            }\r\n            gameui_node.emit(\"choose_card_event\",event)\r\n           \r\n        }.bind(this))\r\n\r\n        this.node.on(\"unchoose_card_event\",function(event){\r\n            console.log(\"--------unchoose_card_event-----------\")\r\n            var gameui_node =  this.node.getChildByName(\"gameingUI\")\r\n            if(gameui_node==null){\r\n               console.log(\"get childer name gameingUI\")\r\n               return\r\n            }\r\n            gameui_node.emit(\"unchoose_card_event\",event)\r\n        }.bind(this))\r\n        //监听给玩家添加三张底牌\r\n        // this.node.on(\"add_three_card\",function(event){\r\n        //     console.log(\"add_three_card:\"+event)\r\n        //     for(var i=0;i<this.playerNodeList.length;i++){\r\n        //         var node = this.playerNodeList[i]\r\n        //         if(node){\r\n        //             //给playernode节点发送事件\r\n        //             node.emit(\"playernode_add_three_card\",event)\r\n        //         }\r\n        //     }\r\n        // }.bind(this))\r\n\r\n        myglobal.socket.request_enter_room({},function(err,result){\r\n            console.log(\"enter_room_resp\"+ JSON.stringify(result))\r\n            if(err!=0){\r\n               console.log(\"enter_room_resp err:\"+err)\r\n            }else{\r\n             \r\n              //enter_room成功\r\n              //notify ={\"seatid\":1,\"playerdata\":[{\"accountid\":\"2117836\",\"nick_name\":\"tiny543\",\"avatarUrl\":\"http://xxx\",\"goldcount\":1000}]}\r\n                var seatid = result.seatindex //自己在房间里的seatid\r\n                this.playerdata_list_pos = []  //3个用户创建一个空用户列表\r\n                this.setPlayerSeatPos(seatid)\r\n\r\n                var playerdata_list = result.playerdata\r\n                var roomid = result.roomid\r\n                this.roomid_label.string = \"房间号:\" + roomid\r\n                myglobal.playerData.housemanageid = result.housemanageid\r\n                \r\n                for(var i=0;i<playerdata_list.length;i++){\r\n                    //consol.log(\"this----\"+this)\r\n                    this.addPlayerNode(playerdata_list[i])\r\n                }\r\n\r\n                if(isopen_sound){\r\n                    cc.audioEngine.stopAll()\r\n                    cc.audioEngine.play(cc.url.raw(\"resources/sound/bg.mp3\"),true) \r\n                 }\r\n            }\r\n            var gamebefore_node = this.node.getChildByName(\"gamebeforeUI\")\r\n            gamebefore_node.emit(\"init\")\r\n        }.bind(this))\r\n\r\n        //在进入房间后，注册其他玩家进入房间的事件\r\n        myglobal.socket.onPlayerJoinRoom(function(join_playerdata){\r\n            //回调的函数参数是进入房间用户消息\r\n            console.log(\"onPlayerJoinRoom:\"+JSON.stringify(join_playerdata))\r\n            this.addPlayerNode(join_playerdata)\r\n        }.bind(this))\r\n        \r\n        //回调参数是发送准备消息的accountid\r\n        myglobal.socket.onPlayerReady(function(data){\r\n            console.log(\"-------onPlayerReady:\"+data)\r\n            for(var i=0;i<this.playerNodeList.length;i++){\r\n                var node = this.playerNodeList[i]\r\n                if(node){\r\n                    node.emit(\"player_ready_notify\",data)\r\n                }\r\n            }\r\n        }.bind(this))\r\n\r\n        myglobal.socket.onGameStart(function(){\r\n            for(var i=0;i<this.playerNodeList.length;i++){\r\n                var node = this.playerNodeList[i]\r\n                if(node){\r\n                    node.emit(\"gamestart_event\")\r\n                }\r\n            }\r\n\r\n        //隐藏gamebeforeUI节点\r\n        var gamebeforeUI = this.node.getChildByName(\"gamebeforeUI\")\r\n            if(gamebeforeUI){\r\n                gamebeforeUI.active = false\r\n            }\r\n        }.bind(this))\r\n\r\n              //监听服务器玩家抢地主消息\r\n        myglobal.socket.onRobState(function(event){\r\n                console.log(\"-----onRobState\"+JSON.stringify(event))\r\n                //onRobState{\"accountid\":\"2162866\",\"state\":1}\r\n                for(var i=0;i<this.playerNodeList.length;i++){\r\n                    var node = this.playerNodeList[i]\r\n                    if(node){\r\n                        //给playernode节点发送事件\r\n                        node.emit(\"playernode_rob_state_event\",event)\r\n                    }\r\n                }\r\n        }.bind(this))\r\n\r\n        //注册监听服务器确定地主消息\r\n        myglobal.socket.onChangeMaster(function(event){\r\n            console.log(\"onChangeMaster\"+event)\r\n            //保存一下地主id\r\n            myglobal.playerData.master_accountid = event\r\n            for(var i=0;i<this.playerNodeList.length;i++){\r\n                var node = this.playerNodeList[i]\r\n                if(node){\r\n                    //给playernode节点发送事件\r\n                    node.emit(\"playernode_changemaster_event\",event)\r\n                }\r\n            }\r\n        }.bind(this))\r\n        \r\n        //注册监听服务器显示底牌消息\r\n        myglobal.socket.onShowBottomCard(function(event){\r\n           console.log(\"onShowBottomCard---------\"+event)\r\n           var gameui_node =  this.node.getChildByName(\"gameingUI\")\r\n           if(gameui_node==null){\r\n              console.log(\"get childer name gameingUI\")\r\n              return\r\n           }\r\n           gameui_node.emit(\"show_bottom_card_event\",event)\r\n        }.bind(this))\r\n    },\r\n\r\n    //seat_index自己在房间的位置id\r\n    setPlayerSeatPos(seat_index){\r\n        if(seat_index < 1 || seat_index > 3){\r\n            console.log(\"seat_index error\"+seat_index)\r\n            return\r\n        }\r\n\r\n        console.log(\"setPlayerSeatPos seat_index:\" + seat_index)\r\n       \r\n        //界面位置转化成逻辑位置\r\n        switch(seat_index){\r\n            case 1:\r\n                   this.playerdata_list_pos[1] = 0\r\n                   this.playerdata_list_pos[2] = 1 \r\n                   this.playerdata_list_pos[3] = 2\r\n              break\r\n             case 2:\r\n                   \r\n\r\n                    this.playerdata_list_pos[2] = 0\r\n                    this.playerdata_list_pos[3] = 1\r\n                    this.playerdata_list_pos[1] = 2\r\n                    break\r\n             case 3:\r\n                    this.playerdata_list_pos[3] = 0     \r\n                    this.playerdata_list_pos[1] = 1\r\n                    this.playerdata_list_pos[2] = 2\r\n                    break\r\n            default: \r\n              break      \r\n        } \r\n\r\n    },\r\n\r\n    addPlayerNode(player_data){\r\n        var playernode_inst = cc.instantiate(this.player_node_prefabs)\r\n        playernode_inst.parent = this.node\r\n        //创建的节点存储在gamescene的列表中\r\n        this.playerNodeList.push(playernode_inst)\r\n\r\n        //玩家在room里的位置索引(逻辑位置)\r\n        var index = this.playerdata_list_pos[player_data.seatindex]\r\n        console.log(\"index \"+player_data.seatindex+ \" \"+index)\r\n        playernode_inst.position = this.players_seat_pos.children[index].position\r\n        playernode_inst.getComponent(\"player_node\").init_data(player_data,index)\r\n    },\r\n\r\n    start () {\r\n    },\r\n\r\n    /*\r\n     //通过accountid获取用户出牌放在gamescend的位置 \r\n     做法：先放3个节点在gameacene的场景中cardsoutzone(012)\r\n           \r\n    */\r\n    getUserOutCardPosByAccount(accountid){\r\n        console.log(\"getUserOutCardPosByAccount accountid:\"+accountid)\r\n        for(var i=0;i<this.playerNodeList.length;i++){\r\n            var node = this.playerNodeList[i]\r\n            if(node){\r\n                //获取节点绑定的组件\r\n                var node_script = node.getComponent(\"player_node\")\r\n                //如果accountid和player_node节点绑定的accountid相同\r\n                //接获取player_node的子节点\r\n                if(node_script.accountid===accountid){\r\n                  var seat_node = this.players_seat_pos.children[node_script.seat_index]\r\n                  var index_name = \"cardsoutzone\"+node_script.seat_index\r\n                  //console.log(\"getUserOutCardPosByAccount index_name:\"+index_name)\r\n                  var out_card_node = seat_node.getChildByName(index_name)\r\n                  //console.log(\"OutZone:\"+ out_card_node.name)\r\n                  return out_card_node\r\n                }\r\n            }\r\n        }\r\n\r\n        return null\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}