{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\data/assets\\scripts\\data\\socket_ctr.js"],"names":["socketCtr","that","respone_map","call_index","_socket","event","_sendmsg","cmdtype","req","callindex","emit","cmd","data","_request","callback","console","log","JSON","stringify","initSocket","opts","window","io","connect","defines","serverUrl","on","res","hasOwnProperty","callBackIndex","result","type","fire","request_wxLogin","request_creatroom","request_jion","request_enter_room","request_buchu_card","request_chu_card","onPlayerJoinRoom","onPlayerReady","onGameStart","onChangeHouseManage","requestReady","requestStart","requestRobState","state","onPushCards","onCanRobState","onRobState","onChangeMaster","onShowBottomCard","onCanChuCard","onRoomChangeState","onOtherPlayerChuCard"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\data","sourcesContent":["import eventlister from \"../util/event_lister.js\"\r\n\r\nconst socketCtr = function(){\r\n    var that = {}\r\n    var respone_map = {} \r\n    var call_index = 0\r\n\r\n    var _socket = null\r\n    var event = eventlister({})\r\n    const _sendmsg = function(cmdtype,req,callindex){\r\n        _socket.emit(\"notify\",{cmd:cmdtype,data:req,callindex:callindex})\r\n    } \r\n \r\n    const _request = function(cmdtype,req,callback){\r\n        console.log(\"send cmd:\"+cmdtype+\"  \"+ JSON.stringify(req))\r\n        call_index++ \r\n        respone_map[call_index] = callback\r\n        _sendmsg(cmdtype,req,call_index)\r\n    } \r\n  \r\n        \r\n    that.initSocket = function(){\r\n        var opts = {\r\n            'reconnection':false,\r\n            'force new connection': true,\r\n            'transports':['websocket', 'polling']\r\n        }\r\n        _socket = window.io.connect(defines.serverUrl,opts);\r\n\r\n        _socket.on(\"connection\",function(){\r\n            console.log(\"connect server success!!\")\r\n          })\r\n\r\n       _socket.on(\"notify\",function(res){\r\n         console.log(\"on notify cmd:\" + JSON.stringify(res))\r\n         if(respone_map.hasOwnProperty(res.callBackIndex)){\r\n           var callback = respone_map[res.callBackIndex]\r\n           if(callback){\r\n               callback(res.result,res.data)\r\n           }\r\n          }else{\r\n           //if(res.callBackIndex!=0){\r\n           //console.log(\"not found call index\",res.callBackIndex)\r\n              \r\n               //提交一个监听的事件给监听器\r\n        //  on notify cmd:{\"type\":\"player_joinroom_notify\",\"result\":0,\"data\":\r\n        //  {\"accountid\":\"2586422\",\"nick_name\":\"tiny110\",\"avatarUrl\":\r\n        //  \"avatar_3\",\"goldcount\":1000,\"seatindex\":2},\"callBackIndex\":null}\r\n              //没有找到回到函数，就给事件监听器提交一个事件\r\n              var type = res.type\r\n              event.fire(type,res.data)\r\n          // }\r\n           \r\n         }\r\n\r\n        })\r\n\r\n    }\r\n\r\n    that.request_wxLogin = function(req,callback){\r\n        _request(\"wxlogin\",req,callback)\r\n    }\r\n    \r\n    that.request_creatroom = function(req,callback){\r\n        _request(\"createroom_req\",req,callback)\r\n    }\r\n\r\n    that.request_jion = function(req,callback){\r\n        _request(\"joinroom_req\",req,callback)\r\n    }\r\n\r\n    that.request_enter_room = function(req,callback){\r\n        _request(\"enterroom_req\",req,callback)\r\n    }\r\n\r\n    //发送不出牌信息\r\n    that.request_buchu_card =  function(req,callback){\r\n        _request(\"chu_bu_card_req\",req,callback)\r\n    }\r\n    /*玩家出牌\r\n      需要判断: \r\n         出的牌是否符合规则\r\n         和上个出牌玩家比较，是否满足条件\r\n\r\n    */\r\n    that.request_chu_card = function(req,callback){\r\n        _request(\"chu_card_req\",req,callback)\r\n    }\r\n    //监听其他玩家进入房间消息\r\n    that.onPlayerJoinRoom = function(callback){\r\n         event.on(\"player_joinroom_notify\",callback)\r\n    }\r\n\r\n    that.onPlayerReady = function(callback){\r\n        event.on(\"player_ready_notify\",callback)\r\n    }\r\n\r\n    that.onGameStart = function(callback){\r\n        if(callback){\r\n           event.on(\"gameStart_notify\",callback)\r\n        }\r\n    }\r\n\r\n    that.onChangeHouseManage = function(callback){\r\n        if(callback){\r\n            event.on(\"changehousemanage_notify\",callback)\r\n        }\r\n    }\r\n    //发送ready消息\r\n    that.requestReady = function(){\r\n        _sendmsg(\"player_ready_notify\",{},null)\r\n    }\r\n\r\n    that.requestStart = function(callback){\r\n        _request(\"player_start_notify\",{},callback)\r\n    }\r\n\r\n    //玩家通知服务器抢地主消息\r\n    that.requestRobState = function(state){\r\n        _sendmsg(\"player_rob_notify\",state,null)\r\n    }\r\n    //服务器下发牌通知\r\n    that.onPushCards = function(callback){\r\n        if(callback){\r\n            event.on(\"pushcard_notify\",callback)\r\n         }\r\n    }\r\n\r\n    //监听服务器通知开始抢地主消息\r\n    that.onCanRobState = function(callback){\r\n        if(callback){\r\n            event.on(\"canrob_notify\",callback)\r\n         }\r\n    }\r\n\r\n    //监听服务器:通知谁抢地主操作消息\r\n    that.onRobState = function(callback){\r\n        if(callback){\r\n            event.on(\"canrob_state_notify\",callback)\r\n         }\r\n    }\r\n\r\n    //监听服务器:确定地主消息\r\n    that.onChangeMaster = function(callback){\r\n        if(callback){\r\n            event.on(\"change_master_notify\",callback)\r\n         }\r\n    }\r\n\r\n    //监听服务器:显示底牌消息\r\n    that.onShowBottomCard = function(callback){\r\n        if(callback){\r\n            event.on(\"change_showcard_notify\",callback)\r\n         }\r\n    }\r\n\r\n    //监听服务器:可以出牌消息\r\n    that.onCanChuCard = function(callback){\r\n        if(callback){\r\n            event.on(\"can_chu_card_notify\",callback)\r\n        }\r\n    }\r\n\r\n    that.onRoomChangeState = function(callback){\r\n        if(callback){\r\n            event.on(\"room_state_notify\",callback)\r\n        }\r\n    }\r\n\r\n    that.onOtherPlayerChuCard = function(callback){\r\n        if(callback){\r\n            event.on(\"other_chucard_notify\",callback)\r\n        }\r\n    }\r\n    return that\r\n}\r\n\r\nexport default socketCtr "]}