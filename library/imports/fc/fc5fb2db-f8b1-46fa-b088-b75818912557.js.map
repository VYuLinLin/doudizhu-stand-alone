{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\gameScene/assets\\scripts\\gameScene\\gameingUI.js"],"names":["ddzConstants","require","ddzData","cc","Class","Component","properties","gameingUI","Node","card_prefab","Prefab","robUI","timeLabel","Label","cardsNode","bottom_card_pos_node","playingUI_node","tipsLabel","loseNode","winNode","fapaiAudio","type","AudioClip","jiaodizhuAudio","buqiangAudio","cardsAudio","buyaoAudio","chupaiAudio","onLoad","cards_node","card_width","bottom_card","bottom_card_data","choose_card_data","outcar_zone","push_card_tmp","promptCount","promptList","node","on","data","console","log","i","length","card","show_data","call_data","run","callFunc","target","activedata","show_card","obj","getComponent","showCards","runAction","sequence","rotateBy","scaleBy","common","audio","PlayEffect","myglobal","playerData","userId","masterUserId","scheduleOnce","pushThreeCard","bind","start","CC_EDITOR","gameStateNotify","addListener","gameStateHandler","window","$socket","_chooseCardNotify","_unchooseCardNotify","pushCardNotify","canrobNotify","selfPlayAHandNotify","rootPlayAHandNotify","gameEndNotify","onDestroy","removeListener","remove","cardData","push","cardId","index","splice","state","gameState","GAMESTART","active","removeAllChildren","card_data","cur_index_card","pushCard","_runactive_pushcard","parent","emit","isopen_sound","audioEngine","stop","fapai_audioID","move_node","newx","x","action","moveTo","v2","customSchedulerOnce","count","callback","unschedule","qian_state","buqiang","string","schedule","clearOutZone","cards","gameScene_script","outCard_node","getUserOutCardPosByAccount","node_cards","instantiate","delay","random","playerNode","getUserNodeByAccount","schedulerOnce","appendOtherCardsToOutZone","subtractCards","isWin","otherPlayerCards","WAITREADY","sortCard","sort","y","a","b","hasOwnProperty","value","king","timeout","setTimeout","zIndex","width","scale","di_card","schedulePushThreeCard","updateCards","last_card_x","destoryCard","choose_card","destroy_card","j","caardIndex","removeFromParent","appendCardsToOutZone","children","destroy","pushCardSort","yoffset","addChild","zPoint","cardNode","getChildren","setScale","setPosition","zeroPoint","playPushCardSound","card_name","CardsValue","one","name","play","url","raw","onButtonClick","event","customData","qiang","map","promptCards","cardJs","val","shape","EventType","TOUCH_START"],"mappings":"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","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\gameScene","sourcesContent":["import myglobal from \"../mygolbal.js\"\r\nconst ddzConstants = require('ddzConstants')\r\nconst ddzData = require('ddzData')\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    gameingUI: cc.Node,\r\n    card_prefab: cc.Prefab,\r\n    robUI: cc.Node, // 抢地主按钮节点\r\n    timeLabel: cc.Label, // 计时器节点\r\n    cardsNode: cc.Node, // 扑克节点\r\n    bottom_card_pos_node: cc.Node, // 底牌节点\r\n    playingUI_node: cc.Node, // 出牌提示节点\r\n    tipsLabel: cc.Label, //玩家出牌不合法的tips\r\n    loseNode: cc.Node, // 失败特效节点\r\n    winNode: cc.Node, // 胜利特效节点\r\n    fapaiAudio: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    },\r\n    jiaodizhuAudio: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    },\r\n    buqiangAudio: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    },\r\n    cardsAudio: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    },\r\n    buyaoAudio: {\r\n      type: cc.AudioClip,\r\n      default: []\r\n    },\r\n    chupaiAudio: {\r\n      type: cc.AudioClip,\r\n      default: null\r\n    }\r\n  },\r\n\r\n  onLoad() {\r\n    //自己牌列表 \r\n    this.cards_node = []\r\n    this.card_width = 0\r\n    //当前可以抢地主的accountid\r\n    // this.rob_player_accountid = 0\r\n    //发牌动画是否结束\r\n    // this.fapai_end = false\r\n    //底牌数组\r\n    this.bottom_card = []\r\n    //底牌的json对象数据\r\n    this.bottom_card_data = []\r\n    this.choose_card_data = []\r\n    this.outcar_zone = []\r\n\r\n    this.push_card_tmp = []\r\n    // 提示牌型\r\n    this.promptCount = 0\r\n    this.promptList = []\r\n    //监听服务器可以出牌消息\r\n    // myglobal.socket.onCanChuCard(function (data) {\r\n    //   console.log(\"onCanChuCard\" + JSON.stringify(data))\r\n    //   //判断是不是自己能出牌\r\n    //   if (data == myglobal.playerData.userId) {\r\n    //     //先清理出牌区域\r\n    //     this.clearOutZone(myglobal.playerData.userId)\r\n    //     //先把自己出牌列表置空\r\n    //     //this.choose_card_data=[]\r\n    //     //显示可以出牌的UI\r\n    //     this.playingUI_node.active = true\r\n\r\n    //   }\r\n    // }.bind(this))\r\n\r\n    //监听服务器：其他玩家出牌消息\r\n    // myglobal.socket.onOtherPlayerChuCard(function (data) {\r\n    //   //{\"userId\":\"2357540\",\"cards\":[{\"index\":4,\"card_data\":{\"index\":4,\"value\":1,\"shape\":1}}]}\r\n    //   console.log(\"onOtherPlayerChuCard\" + JSON.stringify(data))\r\n\r\n    //   var userId = data.userId\r\n    //   var gameScene_script = this.node.parent.getComponent(\"gameScene\")\r\n    //   //获取出牌区域节点\r\n    //   var outCard_node = gameScene_script.getUserOutCardPosByAccount(userId)\r\n    //   if (outCard_node == null) {\r\n    //     return\r\n    //   }\r\n\r\n    //   var node_cards = []\r\n    //   for (var i = 0; i < data.cards.length; i++) {\r\n    //     var card = cc.instantiate(this.card_prefab)\r\n    //     card.getComponent(\"card\").showCards(data.cards[i].card_data, myglobal.playerData.userId)\r\n    //     node_cards.push(card)\r\n    //   }\r\n    //   this.appendOtherCardsToOutZone(outCard_node, node_cards, 0)\r\n    // }.bind(this))\r\n\r\n    //内部事件:显示底牌事件,data是三张底牌数据\r\n    this.node.on(\"show_bottom_card_event\", function (data) {\r\n      console.log(\"----show_bottom_card_event\", data)\r\n      this.bottom_card_data = data\r\n      for (var i = 0; i < data.length; i++) {\r\n        var card = this.bottom_card[i]\r\n        var show_data = data[i]\r\n        var call_data = {\r\n          \"obj\": card,\r\n          \"data\": show_data,\r\n        }\r\n        var run = cc.callFunc(function (target, activedata) {\r\n          var show_card = activedata.obj\r\n          var show_data = activedata.data\r\n          show_card.getComponent(\"card\").showCards(show_data)\r\n        }, this, call_data)\r\n\r\n        card.runAction(\r\n          cc.sequence(cc.rotateBy(0, 0, 180),\r\n            cc.rotateBy(0.2, 0, -90),\r\n            run,\r\n            cc.rotateBy(0.2, 0, -90),\r\n            cc.scaleBy(1, 1.2))\r\n        )\r\n      }\r\n      common.audio.PlayEffect(this.cardsAudio)\r\n      //this.node.parent.emit(\"change_room_state_event\",defines.gameState.ROOM_PLAYING)\r\n      //如果自己地主，给加上三张底牌\r\n      if (myglobal.playerData.userId === myglobal.playerData.masterUserId) {\r\n        this.scheduleOnce(this.pushThreeCard.bind(this), 0.2)\r\n      }\r\n\r\n\r\n    }.bind(this))\r\n\r\n    //注册监听一个选择牌消息 \r\n    // this.node.on(\"choose_card_event\", function (cardData) {\r\n    //   this.choose_card_data.push(cardData)\r\n    // }.bind(this))\r\n\r\n    // this.node.on(\"unchoose_card_event\", function (cardId) {\r\n    //   for (let i = 0; i < this.choose_card_data.length; i++) {\r\n    //     if (this.choose_card_data[i].index === cardId) {\r\n    //       this.choose_card_data.splice(i, 1)\r\n    //     }\r\n    //   }\r\n    // }.bind(this))\r\n  },\r\n  start() {\r\n    // 监听游戏状态\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.addListener(this.gameStateHandler, this)\r\n    }\r\n    window.$socket.on('_chooseCard', this._chooseCardNotify, this) // 选牌\r\n    window.$socket.on('_unchooseCard', this._unchooseCardNotify, this) // 取消选牌\r\n    window.$socket.on('pushcard_notify', this.pushCardNotify, this) // 发牌\r\n    window.$socket.on('canrob_notify', this.canrobNotify, this) // 抢地主\r\n    window.$socket.on('selfPlayAHandNotify', this.selfPlayAHandNotify, this) // 出牌\r\n    window.$socket.on('rootPlayAHandNotify', this.rootPlayAHandNotify, this) // 机器出牌\r\n    window.$socket.on('gameEndNotify', this.gameEndNotify, this) // 游戏结束\r\n  },\r\n  onDestroy() {\r\n    if (!CC_EDITOR) {\r\n      ddzData.gameStateNotify.removeListener(this.gameStateHandler, this)\r\n    }\r\n    window.$socket.remove('_chooseCard', this)\r\n    window.$socket.remove('_unchooseCard', this)\r\n    window.$socket.remove('pushcard_notify', this)\r\n    window.$socket.remove('canrob_notify', this)\r\n    window.$socket.remove('selfPlayAHandNotify', this)\r\n    window.$socket.remove('rootPlayAHandNotify', this)\r\n    window.$socket.remove('gameEndNotify', this)\r\n  },\r\n  _chooseCardNotify(cardData) {\r\n    this.choose_card_data.push(cardData)\r\n  },\r\n  _unchooseCardNotify(cardId) {\r\n    for (let i = 0; i < this.choose_card_data.length; i++) {\r\n      if (this.choose_card_data[i].index === cardId) {\r\n        this.choose_card_data.splice(i, 1)\r\n      }\r\n    }\r\n  },\r\n  gameStateHandler(state) {\r\n    // 开始游戏 - 已准备\r\n    if (state === ddzConstants.gameState.GAMESTART) {\r\n      // 关闭胜利或失败效果\r\n      this.winNode.active = false\r\n      this.loseNode.active = false\r\n      // 清楚桌面上所有的牌\r\n      this.cards_node = []\r\n      this.bottom_card = []\r\n      this.push_card_tmp = []\r\n      this.cardsNode.removeAllChildren()\r\n      this.bottom_card_pos_node.removeAllChildren()\r\n    }\r\n  },\r\n  pushCardNotify(data) {\r\n    this.card_data = data\r\n    this.cur_index_card = data.length - 1\r\n    this.pushCard(data)\r\n    //左边移动定时器\r\n    this.scheduleOnce(this._runactive_pushcard.bind(this), 0.3)\r\n    this.node.parent.emit(\"pushcard_other_event\")\r\n  },\r\n  //处理发牌的效果\r\n  _runactive_pushcard() {\r\n    if (this.cur_index_card < 0) {\r\n      console.log(\"pushcard end\")\r\n      //发牌动画完成，显示抢地主按钮\r\n      // this.fapai_end = true\r\n      // if (this.rob_player_accountid === myglobal.playerData.userId) {\r\n      //   this.robUI.active = true\r\n      //   this.customSchedulerOnce()\r\n      // }\r\n      if (isopen_sound) {\r\n        cc.audioEngine.stop(this.fapai_audioID)\r\n      }\r\n      //通知gamescene节点，倒计时\r\n      // var sendevent = this.rob_player_accountid\r\n      // this.node.parent.emit(\"canrob_event\", sendevent)\r\n      return\r\n    }\r\n    //原有逻辑  \r\n    // var move_node = this.cards_node[this.cur_index_card]\r\n    // move_node.active = true\r\n    // var newx = move_node.x + (this.card_width * 0.4*this.cur_index_card) - (this.card_width * 0.4)\r\n    // var action = cc.moveTo(0.1, cc.v2(newx, -250));\r\n    // move_node.runAction(action)\r\n    // this.cur_index_card--\r\n    // this.scheduleOnce(this._runactive_pushcard.bind(this),0.3)\r\n\r\n    var move_node = this.cards_node[this.cards_node.length - this.cur_index_card - 1]\r\n    move_node.active = true\r\n    this.push_card_tmp.push(move_node)\r\n    this.fapai_audioID = common.audio.PlayEffect(this.fapaiAudio)\r\n    for (var i = 0; i < this.push_card_tmp.length - 1; i++) {\r\n      var move_node = this.push_card_tmp[i]\r\n      var newx = move_node.x - (this.card_width * 0.4)\r\n      var action = cc.moveTo(0.1, cc.v2(newx, -250));\r\n      move_node.runAction(action)\r\n    }\r\n\r\n    this.cur_index_card--\r\n    this.scheduleOnce(this._runactive_pushcard.bind(this), 0.3)\r\n  },\r\n  // 通知抢地主消息,显示相应的UI\r\n  canrobNotify(data) {\r\n    console.log(\"onCanRobState\", data)\r\n    //这里需要2个变量条件：自己是下一个抢地主，2发牌动画结束\r\n    // this.rob_player_accountid = data\r\n    if (data === myglobal.playerData.userId) {\r\n      this.robUI.active = true\r\n      this.customSchedulerOnce()\r\n    }\r\n  },\r\n  //开启一个定时器\r\n  customSchedulerOnce() {\r\n    this.count = 10;\r\n    const callback = function () {\r\n      if (!this.robUI.active) return\r\n      if (!this.count) {\r\n        // 在第六次执行回调时取消这个计时器\r\n        this.robUI.active = false\r\n        this.unschedule(callback)\r\n        window.$socket.emit('canrob_state_notify', {\r\n          userId: myglobal.playerData.userId,\r\n          state: qian_state.buqiang,\r\n        })\r\n        common.audio.PlayEffect(this.buqiangAudio)\r\n      }\r\n      this.timeLabel.string = --this.count\r\n    }\r\n    this.schedule(callback, 1, 10)\r\n  },\r\n  /**\r\n   * @description 出牌\r\n   */\r\n  selfPlayAHandNotify(promptList) {\r\n    console.log('玩家出牌提示', promptList)\r\n    this.promptCount = 0\r\n    this.promptList = promptList\r\n    // 先清理出牌区域\r\n    this.clearOutZone(myglobal.playerData.userId)\r\n    // 显示可以出牌的UI\r\n    this.playingUI_node.active = true\r\n  },\r\n  // 机器出牌\r\n  rootPlayAHandNotify({ userId, cards }) {\r\n    var gameScene_script = this.node.parent.getComponent(\"gameScene\")\r\n    //获取出牌区域节点\r\n    var outCard_node = gameScene_script.getUserOutCardPosByAccount(userId)\r\n    if (!outCard_node) return\r\n    outCard_node.removeAllChildren(true);\r\n\r\n    var node_cards = []\r\n    for (var i = 0; i < cards.length; i++) {\r\n      var card = cc.instantiate(this.card_prefab)\r\n      card.getComponent(\"card\").showCards(cards[i], userId)\r\n      node_cards.push(card)\r\n    }\r\n    const delay = common.random(0, 10)\r\n    const playerNode = gameScene_script.getUserNodeByAccount(userId)\r\n    if (!playerNode) return\r\n    playerNode.schedulerOnce(() => {\r\n      this.appendOtherCardsToOutZone(outCard_node, node_cards, 0)\r\n      playerNode.subtractCards(cards.length)\r\n      // 通知服务，下一家出牌\r\n      window.$socket.emit('nextPlayerNotify', userId)\r\n    }, delay)\r\n  },\r\n  // 游戏结束\r\n  gameEndNotify({ isWin, otherPlayerCards }) {\r\n    console.log('游戏结束', { isWin, otherPlayerCards })\r\n    if (isWin) {\r\n      this.winNode.active = true\r\n    } else {\r\n      this.loseNode.active = true\r\n    }\r\n    ddzData.gameState = ddzConstants.gameState.WAITREADY\r\n  },\r\n  //对牌排序\r\n  sortCard() {\r\n    this.cards_node.sort(function (x, y) {\r\n      var a = x.getComponent(\"card\").card_data;\r\n      var b = y.getComponent(\"card\").card_data;\r\n\r\n      if (a.hasOwnProperty('value') && b.hasOwnProperty('value')) {\r\n        return b.value - a.value;\r\n      }\r\n      if (a.hasOwnProperty('king') && !b.hasOwnProperty('king')) {\r\n        return -1;\r\n      }\r\n      if (!a.hasOwnProperty('king') && b.hasOwnProperty('king')) {\r\n        return 1;\r\n      }\r\n      if (a.hasOwnProperty('king') && b.hasOwnProperty('king')) {\r\n        return b.king - a.king;\r\n      }\r\n    })\r\n    //这里使用固定坐标，因为取this.cards_node[0].xk可能排序为完成，导致x错误\r\n    //所以做1000毫秒的延时\r\n    var x = this.cards_node[0].x;\r\n    var timeout = 1000\r\n    setTimeout(function () {\r\n      //var x = -417.6 \r\n      console.log(\"sort x:\" + x)\r\n      for (let i = 0; i < this.cards_node.length; i++) {\r\n        var card = this.cards_node[i];\r\n        card.zIndex = i; //设置牌的叠加次序,zindex越大显示在上面\r\n        card.x = x + card.width * 0.4 * i;\r\n      }\r\n    }.bind(this), timeout);\r\n  },\r\n  pushCard(data) {\r\n    if (data) {\r\n      data.sort(function (a, b) {\r\n        if (a.hasOwnProperty('value') && b.hasOwnProperty('value')) {\r\n          return b.value - a.value;\r\n        }\r\n        if (a.hasOwnProperty('king') && !b.hasOwnProperty('king')) {\r\n          return -1;\r\n        }\r\n        if (!a.hasOwnProperty('king') && b.hasOwnProperty('king')) {\r\n          return 1;\r\n        }\r\n        if (a.hasOwnProperty('king') && b.hasOwnProperty('king')) {\r\n          return b.king - a.king;\r\n        }\r\n      });\r\n    }\r\n    //创建card预制体\r\n    this.cards_node = []\r\n    for (var i = 0; i < 17; i++) {\r\n\r\n      var card = cc.instantiate(this.card_prefab)\r\n      card.scale = 0.8\r\n      // card.parent = this.node.parent\r\n      card.parent = this.cardsNode\r\n      card.x = card.width * 0.4 * (-0.5) * (-16) + card.width * 0.4 * 0;\r\n      //这里实现为，每发一张牌，放在已经发的牌最后，然后整体移动\r\n      card.y = -250\r\n      card.active = false\r\n\r\n      card.getComponent(\"card\").showCards(data[i], myglobal.playerData.userId)\r\n      //存储牌的信息,用于后面发牌效果\r\n      this.cards_node.push(card)\r\n      this.card_width = card.width\r\n    }\r\n    //创建3张底牌\r\n    this.bottom_card = []\r\n    for (var i = 0; i < 3; i++) {\r\n      var di_card = cc.instantiate(this.card_prefab)\r\n      di_card.scale = 0.4\r\n      // di_card.position = this.bottom_card_pos_node.position\r\n      //三张牌，中间坐标就是bottom_card_pos_node节点坐标，\r\n      //0,和2两张牌左右移动windth*0.4\r\n      if (i == 0) {\r\n        di_card.x = di_card.x - di_card.width * 0.5\r\n      } else if (i == 2) {\r\n        di_card.x = di_card.x + di_card.width * 0.5\r\n      }\r\n      //di_card.x = di_card.width-i*di_card.width-20\r\n      //di_card.y=60\r\n      // di_card.parent = this.node.parent\r\n      di_card.parent = this.bottom_card_pos_node\r\n      //存储在容器里\r\n      this.bottom_card.push(di_card)\r\n    }\r\n  },\r\n  //给玩家发送三张底牌后，过1s,把牌设置到y=-250位置效果\r\n  schedulePushThreeCard() {\r\n    for (var i = 0; i < this.cards_node.length; i++) {\r\n      var card = this.cards_node[i]\r\n      if (card.y == -230) {\r\n        card.y = -250\r\n      }\r\n    }\r\n    this.updateCards()\r\n  },\r\n  //给地主发三张排，并显示在原有牌的后面\r\n  pushThreeCard() {\r\n    //每张牌的其实位置 \r\n    var last_card_x = this.cards_node[this.cards_node.length - 1].x\r\n    for (var i = 0; i < this.bottom_card_data.length; i++) {\r\n      var card = cc.instantiate(this.card_prefab)\r\n      card.scale = 0.8\r\n      // card.parent = this.node.parent\r\n      card.parent = this.cardsNode\r\n\r\n      card.x = last_card_x + ((i + 1) * this.card_width * 0.4)\r\n      card.y = -230  //先把底盘放在-230，在设置个定时器下移到-250的位置\r\n\r\n      //console.log(\"pushThreeCard x:\"+card.x)\r\n      card.getComponent(\"card\").showCards(this.bottom_card_data[i], myglobal.playerData.userId)\r\n      card.active = true\r\n      this.cards_node.push(card)\r\n    }\r\n    this.sortCard()\r\n    //设置一个定时器，在2s后，修改y坐标为-250\r\n    this.scheduleOnce(this.schedulePushThreeCard.bind(this), 2)\r\n  },\r\n\r\n  destoryCard(userId, choose_card) {\r\n    if (!choose_card.length) return\r\n    /*出牌逻辑\r\n      1. 将选中的牌 从父节点中移除\r\n      2. 从this.cards_node 数组中，删除 选中的牌 \r\n      3. 将 “选中的牌” 添加到出牌区域\r\n          3.1 清空出牌区域\r\n          3.2 添加子节点\r\n          3.3 设置scale\r\n          3.4 设置position\r\n      4.  重新设置手中的牌的位置  this.updateCards();\r\n    */\r\n    //1/2步骤删除自己手上的card节点 \r\n    var destroy_card = []\r\n    for (var i = 0; i < choose_card.length; i++) {\r\n      for (var j = 0; j < this.cards_node.length; j++) {\r\n        var caardIndex = this.cards_node[j].getComponent(\"card\").caardIndex\r\n        if (caardIndex == choose_card[i].index) {\r\n          //this.cards_node[j].destroy()\r\n          this.cards_node[j].removeFromParent(true);\r\n          destroy_card.push(this.cards_node[j])\r\n          this.cards_node.splice(j, 1)\r\n        }\r\n      }\r\n    }\r\n    this.appendCardsToOutZone(userId, destroy_card)\r\n    this.updateCards()\r\n  },\r\n\r\n  //清除显示出牌节点全部子节点(就是把出牌的清空)\r\n  clearOutZone(userId) {\r\n    var gameScene_script = this.node.parent.getComponent(\"gameScene\")\r\n    var outCard_node = gameScene_script.getUserOutCardPosByAccount(userId)\r\n    var children = outCard_node.children;\r\n    for (var i = 0; i < children.length; i++) {\r\n      var card = children[i];\r\n      card.destroy()\r\n    }\r\n    outCard_node.removeAllChildren(true);\r\n  },\r\n  //对出的牌做排序\r\n  pushCardSort(cards) {\r\n    if (cards.length == 1) {\r\n      return\r\n    }\r\n    cards.sort(function (x, y) {\r\n      var a = x.getComponent(\"card\").card_data;\r\n      var b = y.getComponent(\"card\").card_data;\r\n\r\n      if (a.hasOwnProperty('value') && b.hasOwnProperty('value')) {\r\n        return b.value - a.value;\r\n      }\r\n      if (a.hasOwnProperty('king') && !b.hasOwnProperty('king')) {\r\n        return -1;\r\n      }\r\n      if (!a.hasOwnProperty('king') && b.hasOwnProperty('king')) {\r\n        return 1;\r\n      }\r\n      if (a.hasOwnProperty('king') && b.hasOwnProperty('king')) {\r\n        return b.king - a.king;\r\n      }\r\n    })\r\n  },\r\n  /**\r\n   * @description 桌面添加新牌\r\n   * @param {cc.Node} outCard_node 玩家出牌区域节点\r\n   * @param {List} cards 牌型节点集合\r\n   * @param {Number} yoffset 移动距离\r\n   */\r\n  appendOtherCardsToOutZone(outCard_node, cards, yoffset) {\r\n    if (!cards.length) {\r\n      const index = common.random(0, 2)\r\n      common.audio.PlayEffect(this.buyaoAudio[index])\r\n      return\r\n    }\r\n    common.audio.PlayEffect(this.chupaiAudio)\r\n    //添加新的子节点\r\n    for (var i = 0; i < cards.length; i++) {\r\n      var card = cards[i];\r\n      outCard_node.addChild(card, 100 + i) //第二个参数是 zorder,保证牌不能被遮住\r\n    }\r\n    //对出牌进行排序\r\n    //设置出牌节点的坐标\r\n    var zPoint = cards.length / 2;\r\n    for (var i = 0; i < cards.length; i++) {\r\n      var cardNode = outCard_node.getChildren()[i]\r\n      var x = (i - zPoint) * 30;\r\n      var y = cardNode.y + yoffset; //因为每个节点需要的Y不一样，做参数传入\r\n      cardNode.setScale(0.5, 0.5);\r\n      cardNode.setPosition(x, y);\r\n    }\r\n  },\r\n  //将 “选中的牌” 添加到出牌区域\r\n  //destroy_card是玩家本次出的牌\r\n  appendCardsToOutZone(userId, destroy_card) {\r\n    if (!destroy_card.length) return\r\n    //先给本次出的牌做一个排序\r\n    this.pushCardSort(destroy_card)\r\n    var gameScene_script = this.node.parent.getComponent(\"gameScene\")\r\n    //获取出牌区域节点\r\n    var outCard_node = gameScene_script.getUserOutCardPosByAccount(userId)\r\n    this.appendOtherCardsToOutZone(outCard_node, destroy_card, 360)\r\n    //sconsole.log(\"OutZone:\"+outCard_node.name)\r\n  },\r\n\r\n  //重新排序手上的牌,并移动\r\n  updateCards() {\r\n    var zeroPoint = this.cards_node.length / 2;\r\n    //var last_card_x = this.cards_node[this.cards_node.length-1].x\r\n    for (var i = 0; i < this.cards_node.length; i++) {\r\n      var cardNode = this.cards_node[i]\r\n      var x = (i - zeroPoint) * (this.card_width * 0.4) + 50;\r\n      cardNode.setPosition(x, -250);\r\n    }\r\n  },\r\n\r\n  playPushCardSound(card_name) {\r\n    console.log(\"playPushCardSound:\" + card_name)\r\n    if (card_name == \"\") return\r\n    switch (card_name) {\r\n      case CardsValue.one.name:\r\n        break\r\n      case CardsValue.double.name:\r\n        if (isopen_sound) {\r\n          cc.audioEngine.play(cc.url.raw(\"resources/sound/duizi.mp3\"))\r\n        }\r\n        break\r\n    }\r\n  },\r\n  // update (dt) {},\r\n  onButtonClick(event, customData) {\r\n    switch (customData) {\r\n      case \"btn_qiandz\": // 不抢\r\n        // myglobal.socket.requestRobState(qian_state.qiang)\r\n        window.$socket.emit('canrob_state_notify', {\r\n          userId: myglobal.playerData.userId,\r\n          state: qian_state.qiang,\r\n        })\r\n        this.robUI.active = false\r\n        common.audio.PlayEffect(this.jiaodizhuAudio)\r\n        break\r\n      case \"btn_buqiandz\": // 抢地主\r\n        // myglobal.socket.requestRobState(qian_state.buqiang)\r\n        window.$socket.emit('canrob_state_notify', {\r\n          userId: myglobal.playerData.userId,\r\n          state: qian_state.buqiang,\r\n        })\r\n        this.robUI.active = false\r\n        common.audio.PlayEffect(this.buqiangAudio)\r\n        break\r\n      case \"nopushcard\":  // 不出牌\r\n        // myglobal.socket.request_buchu_card([], null)\r\n        window.$socket.emit('nextPlayerNotify', myglobal.playerData.userId)\r\n        const index = this.promptList.length ? common.random(0, 2) : 3\r\n        common.audio.PlayEffect(this.buyaoAudio[index])\r\n        this.choose_card_data = []\r\n        this.cards_node.map(node => node.emit(\"reset_card_flag\"))\r\n        this.playingUI_node.active = false\r\n        break\r\n      case \"pushcard\":   // 出牌\r\n        //先获取本次出牌数据\r\n        if (this.choose_card_data.length == 0) {\r\n          this.tipsLabel.string = \"请选择牌!\"\r\n          setTimeout(function () {\r\n            this.tipsLabel.string = \"\"\r\n          }.bind(this), 2000);\r\n        }\r\n        window.$socket.emit('playAHandNotify', {\r\n          userId: myglobal.playerData.userId,\r\n          cards: this.choose_card_data,\r\n        }, ({state}) => {\r\n          if (state === 1) {\r\n            this.destoryCard(myglobal.playerData.userId, this.choose_card_data)\r\n            this.playingUI_node.active = false\r\n          } else {\r\n            //出牌失败，把选择的牌归位\r\n            this.cards_node.map(node => node.emit(\"reset_card_flag\"))\r\n            // for (let i = 0; i < this.cards_node.length; i++) {\r\n            //   this.cards_node[i].emit(\"reset_card_flag\")\r\n            // }\r\n          }\r\n          this.choose_card_data = []\r\n        })\r\n        // myglobal.socket.request_chu_card(this.choose_card_data, function (err, data) {\r\n        //   if (err) {\r\n        //     console.log(\"request_chu_card:\" + err)\r\n        //     console.log(\"request_chu_card\" + JSON.stringify(data))\r\n        //     if (this.tipsLabel.string == \"\") {\r\n        //       this.tipsLabel.string = data.msg\r\n        //       setTimeout(function () {\r\n        //         this.tipsLabel.string = \"\"\r\n        //       }.bind(this), 2000);\r\n        //     }\r\n        //     //出牌失败，把选择的牌归位\r\n        //     for (var i = 0; i < this.cards_node.length; i++) {\r\n        //       var card = this.cards_node[i]\r\n        //       card.emit(\"reset_card_flag\")\r\n        //     }\r\n        //     this.choose_card_data = []\r\n        //   } else {\r\n        //     //出牌成功\r\n        //     console.log(\"resp_chu_card data:\" + JSON.stringify(data))\r\n        //     this.playingUI_node.active = false\r\n        //     //播放出牌的声音\r\n        //     //resp_chu_card data:{\"account\":\"2519901\",\"msg\":\"sucess\",\"cardvalue\":{\"name\":\"Double\",\"value\":1}}\r\n        //     //{\"type\":\"other_chucard_notify\",\"result\":0,\"data\":{\"userId\":\"2519901\",\"cards\":[{\"index\":24,\"card_data\":{\"index\":24,\"value\":6,\"shape\":1}},{\"index\":26,\"card_data\":{\"index\":26,\"value\":6,\"shape\":3}}]},\"callBackIndex\":0}\r\n        //     this.playPushCardSound(data.cardvalue.name)\r\n        //     this.destoryCard(data.account, this.choose_card_data)\r\n        //     this.choose_card_data = []\r\n        //   }\r\n        // }.bind(this))\r\n        break\r\n      case \"tipcard\": // 提示\r\n        // 已选牌归位\r\n        this.choose_card_data = []\r\n        this.cards_node.map(node => node.emit(\"reset_card_flag\"))\r\n        // 根据提示牌型显示\r\n        if (this.promptList.length) {\r\n          const index = this.promptCount % this.promptList.length\r\n          const promptCards = this.promptList[index]\r\n          const cardsNode = this.cards_node\r\n          for (let i = 0; i < promptCards.length; i++) {\r\n            const card = promptCards[i];\r\n            for (let j = 0; j < cardsNode.length; j++) {\r\n              const cardJs = cardsNode[j].getComponent(\"card\");\r\n              const cardData = cardJs.card_data\r\n              if (cardData.val === card.val && cardData.shape === card.shape) {\r\n                cardJs.node.emit(cc.Node.EventType.TOUCH_START)\r\n              }\r\n            }\r\n          }\r\n        }\r\n        this.promptCount++\r\n        break\r\n      default:\r\n        break\r\n    }\r\n  }\r\n});\r\n"]}